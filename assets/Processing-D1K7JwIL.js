import{c as P,r as w,j as i,u as O,a as B,b as G}from"./index-D8dkGBQT.js";import{C as q,a as V,X as Y,b as K,g as W}from"./config-D0i5S2kZ.js";import{D as X}from"./DisclaimerBanner-BbXFXJVF.js";import"./types-BqB19gy9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=P("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=P("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=P("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ee={scout:"Searching ClinicalTrials.gov for matching trials...",extractor:"Extracting eligibility criteria from trial pages...",matcher:"Analyzing how well your profile matches each trial...",advocate:"Generating your personalized voice summary..."};function te({status:e}){switch(e){case"complete":return i.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center",children:i.jsx(K,{className:"w-5 h-5 text-white"})});case"running":return i.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center",children:i.jsx(Q,{className:"w-5 h-5 text-white animate-spin"})});case"error":return i.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500 flex items-center justify-center",children:i.jsx(Y,{className:"w-5 h-5 text-white"})});default:return i.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:i.jsx(J,{className:"w-5 h-5 text-gray-400"})})}}function re({startTime:e}){const[t,o]=w.useState(0);w.useEffect(()=>{const s=setInterval(()=>{o(Math.floor((Date.now()-e)/1e3))},1e3);return()=>clearInterval(s)},[e]);const n=Math.floor(t/60),r=t%60;return i.jsxs("span",{className:"text-sm text-gray-500",children:[n>0?`${n}m `:"",r,"s"]})}function ne({currentStep:e,steps:t,logs:o=[]}){const[n,r]=w.useState(!1),[s]=w.useState({});return w.useEffect(()=>{var a;((a=t[e])==null?void 0:a.status)==="running"&&!s[e]&&(s[e]=Date.now())},[e,t,s]),i.jsxs("div",{className:"w-full max-w-md mx-auto",children:[i.jsx("div",{className:"space-y-4",children:t.map((a,l)=>{const u=a.status==="running",c=a.status==="complete",d=a.status==="error";return i.jsxs("div",{className:"relative",children:[l<t.length-1&&i.jsx("div",{className:`absolute left-4 top-8 w-0.5 h-full -ml-px ${c?"bg-green-500":"bg-gray-200"}`}),i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx(te,{status:a.status}),i.jsxs("div",{className:"flex-1 min-w-0 pb-8",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:`font-medium ${u?"text-blue-700":c?"text-green-700":d?"text-red-700":"text-gray-500"}`,children:a.name}),u&&s[l]&&i.jsx(re,{startTime:s[l]})]}),u&&i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:ee[a.id]}),d&&a.error&&i.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.error}),u&&a.progress!==void 0&&i.jsxs("div",{className:"mt-2",children:[i.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:`${a.progress}%`}})}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.progress,"% complete"]})]}),c&&i.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Completed"})]})]})]},a.id)})}),o.length>0&&i.jsxs("div",{className:"mt-6 border-t pt-4",children:[i.jsx("button",{onClick:()=>r(!n),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700",children:n?i.jsxs(i.Fragment,{children:[i.jsx(q,{className:"w-4 h-4"}),"Hide Details"]}):i.jsxs(i.Fragment,{children:[i.jsx(V,{className:"w-4 h-4"}),"View Details"]})}),n&&i.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg max-h-40 overflow-y-auto",children:i.jsx("ul",{className:"space-y-1 text-xs font-mono text-gray-600",children:o.slice(-10).map((a,l)=>i.jsx("li",{children:a},l))})})]}),i.jsx("div",{className:"mt-6 text-center",children:i.jsxs("p",{className:"text-sm text-gray-500",children:["Step ",e+1," of ",t.length]})})]})}const oe={10001:{lat:40.7484,lng:-73.9967},10019:{lat:40.7654,lng:-73.9856},"02101":{lat:42.3704,lng:-71.0266},"02115":{lat:42.342,lng:-71.0944},19102:{lat:39.9526,lng:-75.168},20001:{lat:38.912,lng:-77.016},21201:{lat:39.2908,lng:-76.6209},30301:{lat:33.749,lng:-84.388},30303:{lat:33.7537,lng:-84.393},33101:{lat:25.7617,lng:-80.1918},33130:{lat:25.7656,lng:-80.2052},28201:{lat:35.2271,lng:-80.8431},37201:{lat:36.1627,lng:-86.7816},60601:{lat:41.8819,lng:-87.6278},60611:{lat:41.893,lng:-87.6166},48201:{lat:42.3314,lng:-83.0458},44101:{lat:41.4993,lng:-81.6944},55401:{lat:44.9833,lng:-93.2667},63101:{lat:38.627,lng:-90.1994},75201:{lat:32.7876,lng:-96.7985},77001:{lat:29.7604,lng:-95.3698},77030:{lat:29.7105,lng:-95.3965},85001:{lat:33.4484,lng:-112.074},87101:{lat:35.0844,lng:-106.6504},73101:{lat:35.4676,lng:-97.5164},90001:{lat:33.9425,lng:-118.2551},90024:{lat:34.0633,lng:-118.4333},94102:{lat:37.7792,lng:-122.4191},94143:{lat:37.7631,lng:-122.4586},92101:{lat:32.7195,lng:-117.1628},98101:{lat:47.6062,lng:-122.3321},97201:{lat:45.5051,lng:-122.675},89101:{lat:36.1699,lng:-115.1398},55905:{lat:44.0225,lng:-92.4669},27710:{lat:36.0014,lng:-78.9382},"02114":{lat:42.3626,lng:-71.0688},21287:{lat:39.2965,lng:-76.5927},10065:{lat:40.7649,lng:-73.9632},10016:{lat:40.7425,lng:-73.978},20892:{lat:39,lng:-77.1},94305:{lat:37.4275,lng:-122.1697}};function k(e){return ae(e)&&oe[e]||null}function ae(e){return/^\d{5}$/.test(e)}const ie=3958.8;function T(e){return e*(Math.PI/180)}function _(e,t){const o=T(e.lat),n=T(t.lat),r=T(t.lat-e.lat),s=T(t.lng-e.lng),a=Math.sin(r/2)*Math.sin(r/2)+Math.cos(o)*Math.cos(n)*Math.sin(s/2)*Math.sin(s/2),l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return ie*l}function se(e,t,o){const n=k(t);if(!n)return[];const r=[];for(const s of e){const a=k(s.zipcode);if(a){const l=_(n,a);l<=o&&r.push({...s,distance:Math.round(l*10)/10})}}return r.sort((s,a)=>(s.distance??0)-(a.distance??0))}function ce(e,t){const o=k(t);return o?e.map(n=>{const r=k(n.zipcode);if(r){const s=_(o,r);return{...n,distance:Math.round(s*10)/10}}return n}):e}const le=5;function ue(e){const t=[{protocolSection:{identificationModule:{nctId:"NCT04613596",briefTitle:`Phase 3 Study of Pembrolizumab Plus Chemotherapy for ${e}`},statusModule:{overallStatus:"RECRUITING"},designModule:{phases:["PHASE3"]},sponsorCollaboratorsModule:{leadSponsor:{name:"Merck Sharp & Dohme LLC"}},conditionsModule:{conditions:[e,"Carcinoma, Non-Small-Cell Lung"]},armsInterventionsModule:{interventions:[{name:"Pembrolizumab",type:"DRUG"},{name:"Chemotherapy",type:"DRUG"}]},contactsLocationsModule:{locations:[{facility:"Memorial Sloan Kettering Cancer Center",city:"New York",state:"New York",zip:"10065",country:"United States"},{facility:"NYU Langone Health",city:"New York",state:"New York",zip:"10016",country:"United States"}]}}},{protocolSection:{identificationModule:{nctId:"NCT05502913",briefTitle:`Targeted Therapy Study for Advanced ${e}`},statusModule:{overallStatus:"RECRUITING"},designModule:{phases:["PHASE2"]},sponsorCollaboratorsModule:{leadSponsor:{name:"AstraZeneca"}},conditionsModule:{conditions:[e]},armsInterventionsModule:{interventions:[{name:"Osimertinib",type:"DRUG"}]},contactsLocationsModule:{locations:[{facility:"Massachusetts General Hospital",city:"Boston",state:"Massachusetts",zip:"02114",country:"United States"}]}}},{protocolSection:{identificationModule:{nctId:"NCT04487587",briefTitle:`Immunotherapy Combination Trial for ${e}`},statusModule:{overallStatus:"RECRUITING"},designModule:{phases:["PHASE2"]},sponsorCollaboratorsModule:{leadSponsor:{name:"Bristol-Myers Squibb"}},conditionsModule:{conditions:[e,"Lung Neoplasms"]},armsInterventionsModule:{interventions:[{name:"Nivolumab",type:"DRUG"},{name:"Ipilimumab",type:"DRUG"}]},contactsLocationsModule:{locations:[{facility:"MD Anderson Cancer Center",city:"Houston",state:"Texas",zip:"77030",country:"United States"}]}}},{protocolSection:{identificationModule:{nctId:"NCT05789108",briefTitle:`Novel CAR-T Cell Therapy for ${e}`},statusModule:{overallStatus:"RECRUITING"},designModule:{phases:["PHASE1"]},sponsorCollaboratorsModule:{leadSponsor:{name:"National Cancer Institute"}},conditionsModule:{conditions:[e]},armsInterventionsModule:{interventions:[{name:"CAR-T Cell Therapy",type:"BIOLOGICAL"}]},contactsLocationsModule:{locations:[{facility:"NIH Clinical Center",city:"Bethesda",state:"Maryland",zip:"20892",country:"United States"}]}}},{protocolSection:{identificationModule:{nctId:"NCT04721444",briefTitle:`Biomarker-Driven Study for ${e} with EGFR Mutation`},statusModule:{overallStatus:"RECRUITING"},designModule:{phases:["PHASE3"]},sponsorCollaboratorsModule:{leadSponsor:{name:"Roche"}},conditionsModule:{conditions:[e,"EGFR Positive"]},armsInterventionsModule:{interventions:[{name:"Erlotinib",type:"DRUG"}]},contactsLocationsModule:{locations:[{facility:"UCSF Medical Center",city:"San Francisco",state:"California",zip:"94143",country:"United States"},{facility:"Stanford Cancer Institute",city:"Stanford",state:"California",zip:"94305",country:"United States"}]}}}];return{studies:t,totalCount:t.length}}async function de(e,t,o,n){return console.log("Using mock trial data for development"),await new Promise(r=>setTimeout(r,1500)),ue(e)}function he(e){if(!e||e.length===0)return"N/A";const t=e[0].toUpperCase();return t.includes("1")?"Phase 1":t.includes("2")?"Phase 2":t.includes("3")?"Phase 3":t.includes("4")?"Phase 4":"N/A"}function me(e){var u,c,d,g,m,h,C;const{protocolSection:t}=e,{identificationModule:o,statusModule:n}=t,r=o.nctId,a=(((u=t.contactsLocationsModule)==null?void 0:u.locations)||[]).filter(p=>p.country==="United States").map(p=>({facility:p.facility||"Unknown Facility",city:p.city||"",state:p.state||"",zipcode:p.zip||""})),l=((d=(c=t.armsInterventionsModule)==null?void 0:c.interventions)==null?void 0:d.map(p=>p.name))||[];return{nctId:r,title:o.briefTitle,phase:he((g=t.designModule)==null?void 0:g.phases),status:n.overallStatus,sponsor:((h=(m=t.sponsorCollaboratorsModule)==null?void 0:m.leadSponsor)==null?void 0:h.name)||"Unknown",conditions:((C=t.conditionsModule)==null?void 0:C.conditions)||[],interventions:l,locations:a,url:`https://clinicaltrials.gov/study/${r}`}}async function ge(e){const{diagnosis:t,zipcode:o,travelRadiusMiles:n,phase:r}=e;try{const s=await de(t,o,n,r);if(!s.studies||s.studies.length===0)return{trials:[],totalFound:0,searchParams:{diagnosis:t,zipcode:o,travelRadiusMiles:n,phase:r}};let a=s.studies.map(me);return a=a.map(u=>{if(u.locations.length===0)return u;const c=se(u.locations,o,n);return c.length===0?{...u,locations:ce(u.locations,o)}:{...u,locations:c}}),a.sort((u,c)=>{var m,h;const d=((m=u.locations[0])==null?void 0:m.distance)??1/0,g=((h=c.locations[0])==null?void 0:h.distance)??1/0;return d-g}),{trials:a.slice(0,le),totalFound:s.totalCount,searchParams:{diagnosis:t,zipcode:o,travelRadiusMiles:n,phase:r}}}catch(s){return console.error("Scout agent error:",s),{trials:[],totalFound:0,searchParams:{diagnosis:t,zipcode:o,travelRadiusMiles:n,phase:r,error:s instanceof Error?s.message:"Unknown error"}}}}function fe(e){return{NCT04613596:{nctId:e,inclusionCriteria:[{criterion:"Histologically confirmed non-small cell lung cancer",category:"diagnosis"},{criterion:"Stage IIIB or IV disease",category:"diagnosis"},{criterion:"ECOG performance status 0-1",category:"other"},{criterion:"At least one measurable lesion per RECIST 1.1",category:"other"},{criterion:"Adequate organ function",category:"other"}],exclusionCriteria:[{criterion:"Prior therapy with anti-PD-1 or anti-PD-L1 agents",category:"treatment"},{criterion:"Active autoimmune disease requiring systemic treatment",category:"other"},{criterion:"Known EGFR or ALK genomic alterations",category:"biomarker"}],ageRange:{min:18,max:120},acceptsHealthyVolunteers:!1,rawText:""},NCT05502913:{nctId:e,inclusionCriteria:[{criterion:"Advanced or metastatic NSCLC",category:"diagnosis"},{criterion:"EGFR mutation positive (Ex19del or L858R)",category:"biomarker"},{criterion:"ECOG performance status 0-2",category:"other"},{criterion:"No prior EGFR TKI therapy",category:"treatment"}],exclusionCriteria:[{criterion:"Brain metastases unless treated and stable",category:"diagnosis"},{criterion:"Prior treatment with osimertinib",category:"treatment"}],ageRange:{min:18,max:120},acceptsHealthyVolunteers:!1,rawText:""},NCT04487587:{nctId:e,inclusionCriteria:[{criterion:"Histologically confirmed NSCLC",category:"diagnosis"},{criterion:"PD-L1 expression >= 1%",category:"biomarker"},{criterion:"No prior systemic therapy for metastatic disease",category:"treatment"},{criterion:"ECOG performance status 0-1",category:"other"}],exclusionCriteria:[{criterion:"EGFR or ALK positive mutations",category:"biomarker"},{criterion:"Active infection requiring systemic therapy",category:"other"}],ageRange:{min:18,max:85},acceptsHealthyVolunteers:!1,rawText:""},NCT05789108:{nctId:e,inclusionCriteria:[{criterion:"Relapsed or refractory NSCLC",category:"diagnosis"},{criterion:"Failed at least 2 prior lines of therapy",category:"treatment"},{criterion:"ECOG performance status 0-1",category:"other"},{criterion:"Adequate bone marrow function",category:"other"}],exclusionCriteria:[{criterion:"Prior CAR-T therapy",category:"treatment"},{criterion:"Active CNS involvement",category:"diagnosis"}],ageRange:{min:18,max:75},acceptsHealthyVolunteers:!1,rawText:""},NCT04721444:{nctId:e,inclusionCriteria:[{criterion:"Advanced NSCLC with confirmed EGFR mutation",category:"biomarker"},{criterion:"Stage IIIB/IV disease",category:"diagnosis"},{criterion:"ECOG performance status 0-2",category:"other"}],exclusionCriteria:[{criterion:"T790M resistance mutation",category:"biomarker"},{criterion:"Prior EGFR TKI within 14 days",category:"treatment"}],ageRange:{min:18,max:120},acceptsHealthyVolunteers:!1,rawText:""}}[e]||{nctId:e,inclusionCriteria:[{criterion:"Confirmed cancer diagnosis",category:"diagnosis"},{criterion:"ECOG 0-2",category:"other"}],exclusionCriteria:[{criterion:"Prior experimental therapy within 30 days",category:"treatment"}],ageRange:{min:18,max:120},acceptsHealthyVolunteers:!1,rawText:""}}async function pe(e){const{nctId:t}=e;return console.log(`Using mock eligibility data for ${t}`),await new Promise(o=>setTimeout(o,500)),fe(t)}const N={diagnosis:10,biomarker:9,stage:8,ecog:7,treatment:6,demographics:5,other:3};function ye(e,t){const o=[...t.inclusionCriteria,...t.exclusionCriteria].find(r=>/ecog|performance status/i.test(r.criterion));if(!o)return{match:!0};const n=o.criterion.match(/ecog\s*(?:ps|score)?\s*(?:of\s*)?(\d)(?:\s*-\s*(\d))?/i);if(n){const r=parseInt(n[1],10),s=n[2]?parseInt(n[2],10):r;return e>=r&&e<=s?{match:!0}:{match:!1,reason:`ECOG score ${e} outside required range (${r}-${s})`}}return{match:!0}}function xe(e,t){const o=[],n=[],r=[],s=t.inclusionCriteria.filter(c=>c.category==="biomarker"),a=t.exclusionCriteria.filter(c=>c.category==="biomarker"),l=c=>c.toLowerCase().replace(/[^a-z0-9]/g,""),u=e.map(l);for(const c of s){const d=l(c.criterion);u.some(m=>d.includes(m)||m.includes(d))?o.push(c.criterion):r.push(c.criterion)}for(const c of a){const d=l(c.criterion);u.some(m=>d.includes(m)||m.includes(d))&&n.push(c.criterion)}return{matches:o,conflicts:n,uncertain:r}}function we(e,t){const o=[],n=[],r=t.inclusionCriteria.filter(l=>l.category==="treatment"),s=t.exclusionCriteria.filter(l=>l.category==="treatment"),a=e.map(l=>l.toLowerCase().replace(/[^a-z0-9]/g,""));for(const l of r)if(/prior|previous|must have received/i.test(l.criterion)){const u=l.criterion.toLowerCase();a.some(d=>u.includes(d))&&o.push(`Prior ${l.criterion.slice(0,50)}...`)}for(const l of s){const u=l.criterion.toLowerCase();a.some(d=>u.includes(d))&&n.push(`Excluded: ${l.criterion.slice(0,50)}...`)}return{matches:o,conflicts:n}}function be(e,t,o){if(t.length>0)return{score:Math.max(0,20-t.length*10),category:"not_eligible"};const n=e.reduce((u,c)=>u+c.weight,0),r=Object.values(N).reduce((u,c)=>u+c,0),s=o.length*5;let a=Math.round(n/r*100)-s;a=Math.max(0,Math.min(100,a));let l;return a>=75?l="strong_match":a>=50?l="possible_match":a>=25?l="future_potential":l="not_eligible",{score:a,category:l}}function Ce(e,t,o){var n;return e==="not_eligible"&&o.length>0?`This trial may not be a good fit right now. ${o[0].reason}. Consider discussing alternative options with your doctor.`:e==="strong_match"?`This trial looks like a strong match for you. ${((n=t[0])==null?void 0:n.factor)||"your profile"} aligns well with what the trial is looking for. Talk to your doctor about whether this could be a good option.`:e==="possible_match"?"This trial could potentially be a fit for you. Some of your information matches what they're looking for, but a few details would need to be confirmed. Your doctor can help determine if you qualify.":"This trial might become an option in the future. Right now, there are some differences between your situation and what the trial requires. Your doctor can explain more about what might need to change."}async function ve(e){const{patientProfile:t,eligibilityCriteria:o,nctId:n}=e;return console.log(`Matching patient against trial ${n}`),await new Promise(r=>setTimeout(r,300)),Se(t,o,n)}function Se(e,t,o){const n=[],r=[],s=[],a=ye(e.ecogScore,t);a.match?n.push({factor:`ECOG score ${e.ecogScore} meets requirements`,weight:N.ecog}):a.reason&&r.push({factor:"ECOG Score",reason:a.reason});const l=xe(e.biomarkers,t);l.matches.forEach(h=>{n.push({factor:`Biomarker match: ${h.slice(0,40)}`,weight:N.biomarker})}),l.conflicts.forEach(h=>{r.push({factor:"Biomarker",reason:h})}),s.push(...l.uncertain.map(h=>h.slice(0,50)));const u=we(e.previousTreatments,t);u.matches.forEach(h=>{n.push({factor:h,weight:N.treatment})}),u.conflicts.forEach(h=>{r.push({factor:"Treatment History",reason:h})});const c=t.inclusionCriteria.filter(h=>h.category==="diagnosis");if(c.length>0){const h=e.diagnosis.toLowerCase();c.some(p=>p.criterion.toLowerCase().includes(h)||h.includes(p.criterion.toLowerCase().split(" ")[0]))?n.push({factor:"Diagnosis matches trial requirements",weight:N.diagnosis}):s.push("Diagnosis alignment needs confirmation")}const{score:d,category:g}=be(n,r,s),m=Ce(g,n,r);return{nctId:o,score:d,category:g,matchingFactors:n,blockingFactors:r,uncertainFactors:s,summary:m}}const U={en:"21m00Tcm4TlvDq8ikWAM",es:"AZnzlk1XvdvUeBnXmlld",zh:"g5CIjZEefAph4nQFvHAz",fr:"XrExE9yKIg1WjnnlVkGX",de:"Yko7PKHZNXotIFUBG7I9"},H=U.en,Ee="eleven_flash_v2_5",Me=5e3;function Ie(e){return{apiKey:W(),baseUrl:"https://api.elevenlabs.io/v1"}}function Ne(e){const o=e.split(/\s+/).length/150;return Math.round(o*60)}function Te(e,t=Me){if(e.length<=t)return[e];const o=[],n=e.split(new RegExp("(?<=[.!?])\\s+"));let r="";for(const s of n)(r+s).length>t?(r&&o.push(r.trim()),r=s):r+=(r?" ":"")+s;return r&&o.push(r.trim()),o}async function Re(e,t,o={}){const{voiceId:n,language:r="en",stability:s=.5,similarityBoost:a=.75}=o,l=n||U[r]||H,u=Te(t);if(u.length===1)return F(e,u[0],l,s,a);const c=[];let d=0;for(const h of u){const C=await F(e,h,l,s,a),S=await(await fetch(C.audioUrl)).blob();c.push(S),d+=C.duration}const g=new Blob(c,{type:"audio/mpeg"});return{audioUrl:URL.createObjectURL(g),duration:d,format:"mp3"}}async function F(e,t,o,n,r){const s=`${e.baseUrl}/text-to-speech/${o}`;try{const a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","xi-api-key":e.apiKey},body:JSON.stringify({text:t,model_id:Ee,voice_settings:{stability:n,similarity_boost:r}})});if(!a.ok){const c=await a.json().catch(()=>({}));throw a.status===401?new Error("Invalid ElevenLabs API key"):a.status===429?new Error("ElevenLabs rate limit exceeded. Character quota may be depleted."):a.status===400?new Error("Text is too long or contains invalid characters"):new Error(`ElevenLabs API error: ${a.statusText} - ${JSON.stringify(c)}`)}const l=await a.blob();return{audioUrl:URL.createObjectURL(l),duration:Ne(t),format:"mp3"}}catch(a){throw a instanceof Error?a:new Error("Failed to synthesize speech")}}function ke(e){return U[e]||H}const L="This information is for educational purposes only and should not replace professional medical advice. Please discuss these options with your healthcare provider before making any decisions about clinical trial participation.",D={en:"Hello",es:"Hola",zh:"你好",fr:"Bonjour",de:"Guten Tag"};function je(e,t){const o=D[t]||"Hello",n=e[0];return`${o}. I've found some promising clinical trial options that could be a good fit for you.

The top match is a trial that scores ${n.score} out of 100. ${n.summary}

${e.length>1?`I also found ${e.length-1} other strong matches worth discussing with your doctor.`:""}

Here's what I recommend as next steps: First, print or save these results. Then, schedule a conversation with your oncologist or care team to review these options together. They can help determine which trial, if any, might be right for your specific situation.

Remember: ${L}`}function Le(e,t){return`${D[t]||"Hello"}. I've reviewed available clinical trials and found some possible options worth exploring.

I found ${e.length} trials that could potentially be a fit for you. While they're not perfect matches, they're worth discussing with your doctor. Some details about your medical history would need to be confirmed to determine final eligibility.

Your next step is to share these results with your healthcare team. They know your complete medical history and can help identify which trials, if any, make sense to pursue.

${L}`}function Ae(e){return`${D[e]||"Hello"}. I've searched through available clinical trials, and while I didn't find a strong match right now, please don't be discouraged.

Clinical trials are constantly opening and closing, and new options become available regularly. Your situation may also change over time, which could open up new possibilities.

Here's what you can do: Talk to your doctor about other treatment options available to you. You might also consider checking back in a few months, as new trials often open up.

Stay hopeful, and remember that you have a healthcare team supporting you through this journey.

${L}`}function $e(e,t){const o=e.filter(r=>r.category==="strong_match"),n=e.filter(r=>r.category==="possible_match");return o.length>0?je(o,t):n.length>0?Le(n,t):Ae(t)}async function Pe(e){const{matchResults:t,language:o="en"}=e;console.log("Generating patient advocate script..."),await new Promise(r=>setTimeout(r,800));let n=$e(t,o);n.includes("educational purposes only")||(n+=`

${L}`);try{const r=Ie(),s=await Re(r,n,{language:o,voiceId:ke(o),stability:.5,similarityBoost:.75});return{text:n,audioUrl:s.audioUrl,duration:s.duration,language:o}}catch(r){return console.error("Audio synthesis failed:",r),{text:n,audioUrl:"",duration:Ue(n),language:o}}}function Ue(e){const t=e.split(/\s+/).length;return Math.round(t/150*60)}const j=[{id:"scout",name:"Finding Trials"},{id:"extractor",name:"Analyzing Eligibility"},{id:"matcher",name:"Matching Your Profile"},{id:"advocate",name:"Creating Summary"}];function y(e,t,o,n){return{...j.find(s=>s.id===e),status:t,progress:o,error:n}}async function De(e){return new Promise(t=>setTimeout(t,e))}async function R(e,t=2,o=1e3){let n;for(let r=0;r<=t;r++)try{return await e()}catch(s){n=s instanceof Error?s:new Error(String(s)),r<t&&await De(o*Math.pow(2,r))}throw n}async function Ge(e,t,o={}){const{maxTrials:n=5,concurrency:r=3,abortSignal:s}=o,a=Date.now(),l=[],u=[],c=g=>{u.push(`[${new Date().toISOString()}] ${g}`)},d=()=>{if(s!=null&&s.aborted)throw new Error("Pipeline cancelled by user")};try{c("Starting trial discovery..."),t(y("scout","running"),u),d();const g=await R(()=>ge({diagnosis:e.diagnosis,zipcode:e.zipcode,travelRadiusMiles:e.travelRadiusMiles}));if(g.trials.length===0)return c("No matching trials found"),l.push(y("scout","complete")),{trials:[],matchResults:[],voiceScript:void 0,completedSteps:[y("scout","complete"),y("extractor","complete"),y("matcher","complete"),y("advocate","complete")],duration:Date.now()-a};const m=g.trials.slice(0,n);c(`Found ${g.totalFound} trials, processing top ${m.length}`),l.push(y("scout","complete")),t(y("scout","complete"),u),c("Extracting eligibility criteria..."),t(y("extractor","running",0),u),d();const h=new Map,C=[];for(let f=0;f<m.length;f+=r){d();const v=m.slice(f,f+r);(await Promise.allSettled(v.map(x=>R(()=>pe({nctId:x.nctId}))))).forEach((x,I)=>{const E=v[I];x.status==="fulfilled"?(h.set(E.nctId,x.value),c(`Extracted criteria for ${E.nctId}`)):(C.push(E.nctId),c(`Failed to extract criteria for ${E.nctId}: ${x.reason}`))});const M=Math.round((f+v.length)/m.length*100);t(y("extractor","running",M),u)}l.push(y("extractor","complete")),t(y("extractor","complete"),u);const p=m.filter(f=>h.has(f.nctId));if(p.length===0)return c("Could not extract criteria for any trials"),{trials:m,matchResults:[],voiceScript:void 0,completedSteps:[...l,y("matcher","error",void 0,"No criteria extracted")],duration:Date.now()-a};c("Matching your profile against trials..."),t(y("matcher","running",0),u),d();const S=[],A=[];for(let f=0;f<p.length;f+=r){d();const v=p.slice(f,f+r);(await Promise.allSettled(v.map(x=>{const I=h.get(x.nctId);return R(()=>ve({patientProfile:e,eligibilityCriteria:I,nctId:x.nctId}))}))).forEach((x,I)=>{const E=v[I];x.status==="fulfilled"?(S.push(x.value),c(`Matched ${E.nctId}: ${x.value.category} (${x.value.score})`)):(A.push(E.nctId),c(`Failed to match ${E.nctId}: ${x.reason}`))});const M=Math.round((f+v.length)/p.length*100);t(y("matcher","running",M),u)}S.sort((f,v)=>v.score-f.score),l.push(y("matcher","complete")),t(y("matcher","complete"),u),c("Creating your personalized summary..."),t(y("advocate","running"),u),d();let b;try{b=await R(()=>Pe({matchResults:S,patientProfile:e,language:e.languagePreference})),c("Voice summary created successfully")}catch(f){c(`Voice summary failed: ${f}`)}return l.push(y("advocate","complete")),t(y("advocate","complete"),u),{trials:p,matchResults:S,voiceScript:b,completedSteps:l,duration:Date.now()-a}}catch(g){const m=g instanceof Error?g.message:String(g);c(`Pipeline error: ${m}`);const h=l.length<j.length?j[l.length].id:"advocate";throw l.push(y(h,"error",void 0,m)),g}}function z(){return j.map(e=>({...e,status:"pending"}))}function Oe(){const e=O(),{patientProfile:t,setPipelineResults:o}=B(),[n,r]=w.useState(z),[s,a]=w.useState(0),[l,u]=w.useState([]),[c,d]=w.useState(null),[g,m]=w.useState(!1),h=w.useRef(null),C=w.useRef(!1);w.useEffect(()=>{t||e("/intake")},[t,e]);const p=w.useCallback(async()=>{if(!(!t||C.current)){C.current=!0,d(null),r(z()),a(0),u([]),h.current=new AbortController;try{const b=await Ge(t,(f,v)=>{r($=>{const M=[...$],x=M.findIndex(I=>I.id===f.id);return x>=0&&(M[x]=f,f.status==="running"&&a(x)),M}),v&&u(v)},{abortSignal:h.current.signal});o(b),e("/results")}catch(b){if(b instanceof Error&&b.message==="Pipeline cancelled by user"){e("/intake");return}d(b instanceof Error?b.message:"An unexpected error occurred")}}},[t,e,o]);w.useEffect(()=>{p()},[p]),w.useEffect(()=>{const b=f=>{c||(f.preventDefault(),f.returnValue="")};return window.addEventListener("beforeunload",b),()=>window.removeEventListener("beforeunload",b)},[c]);const S=()=>{m(!0),C.current=!1,d(null),p().finally(()=>m(!1))},A=()=>{var b;(b=h.current)==null||b.abort(),e("/intake")};return t?i.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[i.jsxs("main",{className:"max-w-xl mx-auto px-4 py-16",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Finding Your Matches"}),i.jsx("p",{className:"mt-2 text-gray-600",children:"This may take a moment while we analyze available trials..."})]}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8",children:i.jsx(ne,{currentStep:s,steps:n,logs:l})}),c&&i.jsx("div",{className:"mt-6 bg-red-50 border border-red-200 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Z,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-medium text-red-800",children:"Something went wrong"}),i.jsx("p",{className:"mt-1 text-sm text-red-700",children:c}),i.jsxs("div",{className:"mt-4 flex gap-3",children:[i.jsx("button",{onClick:S,disabled:g,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:g?i.jsxs(i.Fragment,{children:[i.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}),"Retrying..."]}):i.jsxs(i.Fragment,{children:[i.jsx(G,{className:"w-4 h-4 mr-2"}),"Try Again"]})}),i.jsx("button",{onClick:()=>e("/intake"),className:"px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-lg border border-gray-300 hover:bg-gray-50",children:"Modify Profile"})]})]})]})}),!c&&i.jsx("div",{className:"mt-8 text-center",children:i.jsx("button",{onClick:A,className:"text-sm text-gray-500 hover:text-gray-700 underline",children:"Cancel and go back"})}),!c&&i.jsxs("div",{className:"mt-12 p-6 bg-blue-50 rounded-lg",children:[i.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Did you know?"}),i.jsx("p",{className:"text-sm text-blue-800",children:"Clinical trials are essential for developing new treatments. They help researchers understand how well new medicines work and what side effects they might cause. Every approved treatment was once tested in a clinical trial."})]})]}),i.jsx(X,{})]}):null}export{Oe as Processing};
//# sourceMappingURL=Processing-D1K7JwIL.js.map
