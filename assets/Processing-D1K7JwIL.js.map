{"version":3,"file":"Processing-D1K7JwIL.js","sources":["../../node_modules/lucide-react/dist/esm/icons/alert-circle.js","../../node_modules/lucide-react/dist/esm/icons/circle.js","../../node_modules/lucide-react/dist/esm/icons/loader-2.js","../../src/components/ProgressIndicator.tsx","../../lib/geo-utils.ts","../../agents/scout/index.ts","../../agents/extractor/index.ts","../../agents/matcher/index.ts","../../lib/elevenlabs.ts","../../agents/advocate/index.ts","../../lib/orchestrator.ts","../../src/pages/Processing.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst AlertCircle = createLucideIcon(\"AlertCircle\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n]);\n\nexport { AlertCircle as default };\n//# sourceMappingURL=alert-circle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Circle = createLucideIcon(\"Circle\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n]);\n\nexport { Circle as default };\n//# sourceMappingURL=circle.js.map\n","/**\n * @license lucide-react v0.344.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Loader2 = createLucideIcon(\"Loader2\", [\n  [\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]\n]);\n\nexport { Loader2 as default };\n//# sourceMappingURL=loader-2.js.map\n","import { useEffect, useState } from 'react';\nimport { Check, X, Loader2, Circle, ChevronDown, ChevronUp } from 'lucide-react';\nimport type { PipelineStep } from '../../lib/schemas';\n\n// ============================================================================\n// Props\n// ============================================================================\n\ninterface ProgressIndicatorProps {\n  currentStep: number;\n  steps: PipelineStep[];\n  logs?: string[];\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst STEP_DESCRIPTIONS: Record<string, string> = {\n  scout: 'Searching ClinicalTrials.gov for matching trials...',\n  extractor: 'Extracting eligibility criteria from trial pages...',\n  matcher: 'Analyzing how well your profile matches each trial...',\n  advocate: 'Generating your personalized voice summary...',\n};\n\n// ============================================================================\n// Components\n// ============================================================================\n\nfunction StepIcon({ status }: { status: PipelineStep['status'] }) {\n  switch (status) {\n    case 'complete':\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center\">\n          <Check className=\"w-5 h-5 text-white\" />\n        </div>\n      );\n    case 'running':\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center\">\n          <Loader2 className=\"w-5 h-5 text-white animate-spin\" />\n        </div>\n      );\n    case 'error':\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-red-500 flex items-center justify-center\">\n          <X className=\"w-5 h-5 text-white\" />\n        </div>\n      );\n    default:\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center\">\n          <Circle className=\"w-5 h-5 text-gray-400\" />\n        </div>\n      );\n  }\n}\n\nfunction ElapsedTimer({ startTime }: { startTime: number }) {\n  const [elapsed, setElapsed] = useState(0);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setElapsed(Math.floor((Date.now() - startTime) / 1000));\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [startTime]);\n\n  const minutes = Math.floor(elapsed / 60);\n  const seconds = elapsed % 60;\n\n  return (\n    <span className=\"text-sm text-gray-500\">\n      {minutes > 0 ? `${minutes}m ` : ''}{seconds}s\n    </span>\n  );\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function ProgressIndicator({ currentStep, steps, logs = [] }: ProgressIndicatorProps) {\n  const [showLogs, setShowLogs] = useState(false);\n  const [stepStartTimes] = useState<Record<number, number>>({});\n\n  // Track when each step starts\n  useEffect(() => {\n    if (steps[currentStep]?.status === 'running' && !stepStartTimes[currentStep]) {\n      stepStartTimes[currentStep] = Date.now();\n    }\n  }, [currentStep, steps, stepStartTimes]);\n\n  return (\n    <div className=\"w-full max-w-md mx-auto\">\n      {/* Steps */}\n      <div className=\"space-y-4\">\n        {steps.map((step, index) => {\n          const isActive = step.status === 'running';\n          const isPast = step.status === 'complete';\n          const isError = step.status === 'error';\n\n          return (\n            <div key={step.id} className=\"relative\">\n              {/* Connecting line */}\n              {index < steps.length - 1 && (\n                <div\n                  className={`absolute left-4 top-8 w-0.5 h-full -ml-px ${\n                    isPast ? 'bg-green-500' : 'bg-gray-200'\n                  }`}\n                />\n              )}\n\n              <div className=\"flex items-start gap-4\">\n                {/* Icon */}\n                <StepIcon status={step.status} />\n\n                {/* Content */}\n                <div className=\"flex-1 min-w-0 pb-8\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3\n                      className={`font-medium ${\n                        isActive\n                          ? 'text-blue-700'\n                          : isPast\n                          ? 'text-green-700'\n                          : isError\n                          ? 'text-red-700'\n                          : 'text-gray-500'\n                      }`}\n                    >\n                      {step.name}\n                    </h3>\n\n                    {/* Timer for active step */}\n                    {isActive && stepStartTimes[index] && (\n                      <ElapsedTimer startTime={stepStartTimes[index]} />\n                    )}\n                  </div>\n\n                  {/* Description or error */}\n                  {isActive && (\n                    <p className=\"text-sm text-gray-500 mt-1\">\n                      {STEP_DESCRIPTIONS[step.id]}\n                    </p>\n                  )}\n\n                  {isError && step.error && (\n                    <p className=\"text-sm text-red-600 mt-1\">{step.error}</p>\n                  )}\n\n                  {/* Progress bar for steps with progress */}\n                  {isActive && step.progress !== undefined && (\n                    <div className=\"mt-2\">\n                      <div className=\"h-1.5 bg-gray-200 rounded-full overflow-hidden\">\n                        <div\n                          className=\"h-full bg-blue-500 rounded-full transition-all duration-300\"\n                          style={{ width: `${step.progress}%` }}\n                        />\n                      </div>\n                      <p className=\"text-xs text-gray-500 mt-1\">\n                        {step.progress}% complete\n                      </p>\n                    </div>\n                  )}\n\n                  {/* Completed indicator */}\n                  {isPast && (\n                    <p className=\"text-sm text-green-600 mt-1\">Completed</p>\n                  )}\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Logs section */}\n      {logs.length > 0 && (\n        <div className=\"mt-6 border-t pt-4\">\n          <button\n            onClick={() => setShowLogs(!showLogs)}\n            className=\"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700\"\n          >\n            {showLogs ? (\n              <>\n                <ChevronUp className=\"w-4 h-4\" />\n                Hide Details\n              </>\n            ) : (\n              <>\n                <ChevronDown className=\"w-4 h-4\" />\n                View Details\n              </>\n            )}\n          </button>\n\n          {showLogs && (\n            <div className=\"mt-2 p-3 bg-gray-50 rounded-lg max-h-40 overflow-y-auto\">\n              <ul className=\"space-y-1 text-xs font-mono text-gray-600\">\n                {logs.slice(-10).map((log, idx) => (\n                  <li key={idx}>{log}</li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Overall progress indicator */}\n      <div className=\"mt-6 text-center\">\n        <p className=\"text-sm text-gray-500\">\n          Step {currentStep + 1} of {steps.length}\n        </p>\n      </div>\n    </div>\n  );\n}\n","// ============================================================================\n// Types\n// ============================================================================\n\nexport interface Coordinates {\n  lat: number;\n  lng: number;\n}\n\nexport interface Location {\n  facility: string;\n  city: string;\n  state: string;\n  zipcode: string;\n  distance?: number;\n}\n\n// ============================================================================\n// US Zipcode Database (subset of common zipcodes)\n// In production, use a complete database or API service\n// ============================================================================\n\nconst ZIPCODE_DATA: Record<string, Coordinates> = {\n  // Major cities - Northeast\n  '10001': { lat: 40.7484, lng: -73.9967 }, // New York, NY\n  '10019': { lat: 40.7654, lng: -73.9856 }, // New York, NY\n  '02101': { lat: 42.3704, lng: -71.0266 }, // Boston, MA\n  '02115': { lat: 42.3420, lng: -71.0944 }, // Boston, MA\n  '19102': { lat: 39.9526, lng: -75.1680 }, // Philadelphia, PA\n  '20001': { lat: 38.9120, lng: -77.0160 }, // Washington, DC\n  '21201': { lat: 39.2908, lng: -76.6209 }, // Baltimore, MD\n\n  // Major cities - Southeast\n  '30301': { lat: 33.7490, lng: -84.3880 }, // Atlanta, GA\n  '30303': { lat: 33.7537, lng: -84.3930 }, // Atlanta, GA\n  '33101': { lat: 25.7617, lng: -80.1918 }, // Miami, FL\n  '33130': { lat: 25.7656, lng: -80.2052 }, // Miami, FL\n  '28201': { lat: 35.2271, lng: -80.8431 }, // Charlotte, NC\n  '37201': { lat: 36.1627, lng: -86.7816 }, // Nashville, TN\n\n  // Major cities - Midwest\n  '60601': { lat: 41.8819, lng: -87.6278 }, // Chicago, IL\n  '60611': { lat: 41.8930, lng: -87.6166 }, // Chicago, IL\n  '48201': { lat: 42.3314, lng: -83.0458 }, // Detroit, MI\n  '44101': { lat: 41.4993, lng: -81.6944 }, // Cleveland, OH\n  '55401': { lat: 44.9833, lng: -93.2667 }, // Minneapolis, MN\n  '63101': { lat: 38.6270, lng: -90.1994 }, // St. Louis, MO\n\n  // Major cities - Southwest\n  '75201': { lat: 32.7876, lng: -96.7985 }, // Dallas, TX\n  '77001': { lat: 29.7604, lng: -95.3698 }, // Houston, TX\n  '77030': { lat: 29.7105, lng: -95.3965 }, // Houston, TX (Medical Center)\n  '85001': { lat: 33.4484, lng: -112.0740 }, // Phoenix, AZ\n  '87101': { lat: 35.0844, lng: -106.6504 }, // Albuquerque, NM\n  '73101': { lat: 35.4676, lng: -97.5164 }, // Oklahoma City, OK\n\n  // Major cities - West Coast\n  '90001': { lat: 33.9425, lng: -118.2551 }, // Los Angeles, CA\n  '90024': { lat: 34.0633, lng: -118.4333 }, // Los Angeles, CA (Westwood)\n  '94102': { lat: 37.7792, lng: -122.4191 }, // San Francisco, CA\n  '94143': { lat: 37.7631, lng: -122.4586 }, // San Francisco, CA (UCSF)\n  '92101': { lat: 32.7195, lng: -117.1628 }, // San Diego, CA\n  '98101': { lat: 47.6062, lng: -122.3321 }, // Seattle, WA\n  '97201': { lat: 45.5051, lng: -122.6750 }, // Portland, OR\n  '89101': { lat: 36.1699, lng: -115.1398 }, // Las Vegas, NV\n\n  // Major medical/research centers\n  '55905': { lat: 44.0225, lng: -92.4669 }, // Rochester, MN (Mayo Clinic)\n  '27710': { lat: 36.0014, lng: -78.9382 }, // Durham, NC (Duke)\n  '02114': { lat: 42.3626, lng: -71.0688 }, // Boston, MA (MGH)\n  '21287': { lat: 39.2965, lng: -76.5927 }, // Baltimore, MD (Johns Hopkins)\n\n  // Additional medical centers (for mock data)\n  '10065': { lat: 40.7649, lng: -73.9632 }, // New York, NY (Memorial Sloan Kettering)\n  '10016': { lat: 40.7425, lng: -73.9780 }, // New York, NY (NYU Langone)\n  '20892': { lat: 39.0000, lng: -77.1000 }, // Bethesda, MD (NIH)\n  '94305': { lat: 37.4275, lng: -122.1697 }, // Stanford, CA (Stanford Medical)\n};\n\n// ============================================================================\n// Coordinate Functions\n// ============================================================================\n\n/**\n * Get coordinates for a US zipcode\n * @param zipcode - 5-digit US zipcode\n * @returns Coordinates or null if not found\n */\nexport function getCoordinates(zipcode: string): Coordinates | null {\n  if (!isValidZipcode(zipcode)) {\n    return null;\n  }\n\n  return ZIPCODE_DATA[zipcode] || null;\n}\n\n/**\n * Validate zipcode format (5 digits, numeric only)\n */\nexport function isValidZipcode(zipcode: string): boolean {\n  return /^\\d{5}$/.test(zipcode);\n}\n\n// ============================================================================\n// Distance Calculation (Haversine Formula)\n// ============================================================================\n\nconst EARTH_RADIUS_MILES = 3958.8;\n\n/**\n * Convert degrees to radians\n */\nfunction toRadians(degrees: number): number {\n  return degrees * (Math.PI / 180);\n}\n\n/**\n * Calculate distance between two coordinates using Haversine formula\n * @param coord1 - First coordinate\n * @param coord2 - Second coordinate\n * @returns Distance in miles\n */\nexport function calculateDistance(coord1: Coordinates, coord2: Coordinates): number {\n  const lat1 = toRadians(coord1.lat);\n  const lat2 = toRadians(coord2.lat);\n  const deltaLat = toRadians(coord2.lat - coord1.lat);\n  const deltaLng = toRadians(coord2.lng - coord1.lng);\n\n  const a =\n    Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n    Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLng / 2) * Math.sin(deltaLng / 2);\n\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n  return EARTH_RADIUS_MILES * c;\n}\n\n/**\n * Calculate distance between two zipcodes\n * @returns Distance in miles or null if either zipcode is invalid\n */\nexport function calculateDistanceByZipcode(\n  zipcode1: string,\n  zipcode2: string\n): number | null {\n  const coord1 = getCoordinates(zipcode1);\n  const coord2 = getCoordinates(zipcode2);\n\n  if (!coord1 || !coord2) {\n    return null;\n  }\n\n  return calculateDistance(coord1, coord2);\n}\n\n// ============================================================================\n// Location Filtering\n// ============================================================================\n\n/**\n * Filter locations within a radius of an origin zipcode\n * @param locations - Array of locations to filter\n * @param originZip - Origin zipcode\n * @param radiusMiles - Maximum distance in miles\n * @returns Filtered locations with distance added, sorted by distance\n */\nexport function filterByRadius(\n  locations: Location[],\n  originZip: string,\n  radiusMiles: number\n): Location[] {\n  const originCoords = getCoordinates(originZip);\n\n  if (!originCoords) {\n    return [];\n  }\n\n  const locationsWithDistance: Location[] = [];\n\n  for (const location of locations) {\n    const locationCoords = getCoordinates(location.zipcode);\n\n    if (locationCoords) {\n      const distance = calculateDistance(originCoords, locationCoords);\n\n      if (distance <= radiusMiles) {\n        locationsWithDistance.push({\n          ...location,\n          distance: Math.round(distance * 10) / 10, // Round to 1 decimal\n        });\n      }\n    }\n  }\n\n  // Sort by distance ascending\n  return locationsWithDistance.sort((a, b) => (a.distance ?? 0) - (b.distance ?? 0));\n}\n\n/**\n * Find the nearest location from an array\n * @returns Nearest location with distance or null if none found\n */\nexport function findNearestLocation(\n  locations: Location[],\n  originZip: string\n): Location | null {\n  const filtered = filterByRadius(locations, originZip, Infinity);\n  return filtered.length > 0 ? filtered[0] : null;\n}\n\n/**\n * Add distance to all locations from an origin\n */\nexport function addDistanceToLocations(\n  locations: Location[],\n  originZip: string\n): Location[] {\n  const originCoords = getCoordinates(originZip);\n\n  if (!originCoords) {\n    return locations;\n  }\n\n  return locations.map((location) => {\n    const locationCoords = getCoordinates(location.zipcode);\n    if (locationCoords) {\n      const distance = calculateDistance(originCoords, locationCoords);\n      return {\n        ...location,\n        distance: Math.round(distance * 10) / 10,\n      };\n    }\n    return location;\n  });\n}\n","import { getClinicalTrialsApiBase } from '../../lib/config';\nimport { filterByRadius, addDistanceToLocations } from '../../lib/geo-utils';\nimport type {\n  ScoutInput,\n  TrialDiscoveryOutput,\n  Trial,\n  Location,\n} from '../../lib/schemas';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface CTGovStudy {\n  protocolSection: {\n    identificationModule: {\n      nctId: string;\n      briefTitle: string;\n    };\n    statusModule: {\n      overallStatus: string;\n    };\n    designModule?: {\n      phases?: string[];\n    };\n    sponsorCollaboratorsModule?: {\n      leadSponsor?: {\n        name: string;\n      };\n    };\n    conditionsModule?: {\n      conditions?: string[];\n    };\n    armsInterventionsModule?: {\n      interventions?: Array<{\n        name: string;\n        type: string;\n      }>;\n    };\n    contactsLocationsModule?: {\n      locations?: Array<{\n        facility: string;\n        city: string;\n        state: string;\n        zip: string;\n        country: string;\n      }>;\n    };\n  };\n}\n\ninterface CTGovResponse {\n  studies: CTGovStudy[];\n  totalCount: number;\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst MAX_TRIALS_TO_RETURN = 5;\nconst PAGE_SIZE = 20;\n\n// Use mock data in development to avoid CORS issues\nconst USE_MOCK_DATA = true;\n\n// ============================================================================\n// Mock Data for Development\n// ============================================================================\n\nfunction getMockTrials(condition: string): CTGovResponse {\n  const mockStudies: CTGovStudy[] = [\n    {\n      protocolSection: {\n        identificationModule: {\n          nctId: 'NCT04613596',\n          briefTitle: `Phase 3 Study of Pembrolizumab Plus Chemotherapy for ${condition}`,\n        },\n        statusModule: { overallStatus: 'RECRUITING' },\n        designModule: { phases: ['PHASE3'] },\n        sponsorCollaboratorsModule: { leadSponsor: { name: 'Merck Sharp & Dohme LLC' } },\n        conditionsModule: { conditions: [condition, 'Carcinoma, Non-Small-Cell Lung'] },\n        armsInterventionsModule: {\n          interventions: [\n            { name: 'Pembrolizumab', type: 'DRUG' },\n            { name: 'Chemotherapy', type: 'DRUG' },\n          ],\n        },\n        contactsLocationsModule: {\n          locations: [\n            { facility: 'Memorial Sloan Kettering Cancer Center', city: 'New York', state: 'New York', zip: '10065', country: 'United States' },\n            { facility: 'NYU Langone Health', city: 'New York', state: 'New York', zip: '10016', country: 'United States' },\n          ],\n        },\n      },\n    },\n    {\n      protocolSection: {\n        identificationModule: {\n          nctId: 'NCT05502913',\n          briefTitle: `Targeted Therapy Study for Advanced ${condition}`,\n        },\n        statusModule: { overallStatus: 'RECRUITING' },\n        designModule: { phases: ['PHASE2'] },\n        sponsorCollaboratorsModule: { leadSponsor: { name: 'AstraZeneca' } },\n        conditionsModule: { conditions: [condition] },\n        armsInterventionsModule: {\n          interventions: [{ name: 'Osimertinib', type: 'DRUG' }],\n        },\n        contactsLocationsModule: {\n          locations: [\n            { facility: 'Massachusetts General Hospital', city: 'Boston', state: 'Massachusetts', zip: '02114', country: 'United States' },\n          ],\n        },\n      },\n    },\n    {\n      protocolSection: {\n        identificationModule: {\n          nctId: 'NCT04487587',\n          briefTitle: `Immunotherapy Combination Trial for ${condition}`,\n        },\n        statusModule: { overallStatus: 'RECRUITING' },\n        designModule: { phases: ['PHASE2'] },\n        sponsorCollaboratorsModule: { leadSponsor: { name: 'Bristol-Myers Squibb' } },\n        conditionsModule: { conditions: [condition, 'Lung Neoplasms'] },\n        armsInterventionsModule: {\n          interventions: [\n            { name: 'Nivolumab', type: 'DRUG' },\n            { name: 'Ipilimumab', type: 'DRUG' },\n          ],\n        },\n        contactsLocationsModule: {\n          locations: [\n            { facility: 'MD Anderson Cancer Center', city: 'Houston', state: 'Texas', zip: '77030', country: 'United States' },\n          ],\n        },\n      },\n    },\n    {\n      protocolSection: {\n        identificationModule: {\n          nctId: 'NCT05789108',\n          briefTitle: `Novel CAR-T Cell Therapy for ${condition}`,\n        },\n        statusModule: { overallStatus: 'RECRUITING' },\n        designModule: { phases: ['PHASE1'] },\n        sponsorCollaboratorsModule: { leadSponsor: { name: 'National Cancer Institute' } },\n        conditionsModule: { conditions: [condition] },\n        armsInterventionsModule: {\n          interventions: [{ name: 'CAR-T Cell Therapy', type: 'BIOLOGICAL' }],\n        },\n        contactsLocationsModule: {\n          locations: [\n            { facility: 'NIH Clinical Center', city: 'Bethesda', state: 'Maryland', zip: '20892', country: 'United States' },\n          ],\n        },\n      },\n    },\n    {\n      protocolSection: {\n        identificationModule: {\n          nctId: 'NCT04721444',\n          briefTitle: `Biomarker-Driven Study for ${condition} with EGFR Mutation`,\n        },\n        statusModule: { overallStatus: 'RECRUITING' },\n        designModule: { phases: ['PHASE3'] },\n        sponsorCollaboratorsModule: { leadSponsor: { name: 'Roche' } },\n        conditionsModule: { conditions: [condition, 'EGFR Positive'] },\n        armsInterventionsModule: {\n          interventions: [{ name: 'Erlotinib', type: 'DRUG' }],\n        },\n        contactsLocationsModule: {\n          locations: [\n            { facility: 'UCSF Medical Center', city: 'San Francisco', state: 'California', zip: '94143', country: 'United States' },\n            { facility: 'Stanford Cancer Institute', city: 'Stanford', state: 'California', zip: '94305', country: 'United States' },\n          ],\n        },\n      },\n    },\n  ];\n\n  return {\n    studies: mockStudies,\n    totalCount: mockStudies.length,\n  };\n}\n\n// ============================================================================\n// API Functions\n// ============================================================================\n\n/**\n * Query ClinicalTrials.gov API v2.0\n */\nasync function queryClinicalTrials(\n  condition: string,\n  zipcode: string,\n  radiusMiles: number,\n  phases?: string[]\n): Promise<CTGovResponse> {\n  // Use mock data to avoid CORS issues in browser\n  if (USE_MOCK_DATA) {\n    console.log('Using mock trial data for development');\n    // Simulate network delay\n    await new Promise((resolve) => setTimeout(resolve, 1500));\n    return getMockTrials(condition);\n  }\n\n  const baseUrl = getClinicalTrialsApiBase();\n  const url = new URL(`${baseUrl}/studies`);\n\n  // Build query parameters\n  url.searchParams.set('query.cond', condition);\n  url.searchParams.set('filter.overallStatus', 'RECRUITING');\n  url.searchParams.set('filter.studyType', 'INTERVENTIONAL');\n  url.searchParams.set('pageSize', String(PAGE_SIZE));\n\n  // Add geographic filter if available\n  if (zipcode) {\n    url.searchParams.set('filter.geo', `distance(${zipcode},${radiusMiles}mi)`);\n  }\n\n  // Add phase filter if specified\n  if (phases && phases.length > 0) {\n    url.searchParams.set('filter.phase', phases.join(','));\n  }\n\n  // Request specific fields\n  url.searchParams.set(\n    'fields',\n    [\n      'NCTId',\n      'BriefTitle',\n      'Phase',\n      'OverallStatus',\n      'LeadSponsorName',\n      'Condition',\n      'InterventionName',\n      'LocationFacility',\n      'LocationCity',\n      'LocationState',\n      'LocationZip',\n      'LocationCountry',\n    ].join(',')\n  );\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      Accept: 'application/json',\n    },\n  });\n\n  if (!response.ok) {\n    if (response.status === 429) {\n      throw new Error('Rate limit exceeded. Please try again later.');\n    }\n    throw new Error(`ClinicalTrials.gov API error: ${response.statusText}`);\n  }\n\n  return response.json();\n}\n\n// ============================================================================\n// Data Transformation\n// ============================================================================\n\n/**\n * Map phase from API response to our schema\n */\nfunction mapPhase(phases?: string[]): Trial['phase'] {\n  if (!phases || phases.length === 0) return 'N/A';\n\n  const phase = phases[0].toUpperCase();\n  if (phase.includes('1')) return 'Phase 1';\n  if (phase.includes('2')) return 'Phase 2';\n  if (phase.includes('3')) return 'Phase 3';\n  if (phase.includes('4')) return 'Phase 4';\n  return 'N/A';\n}\n\n/**\n * Transform API study to our Trial schema\n */\nfunction transformStudyToTrial(study: CTGovStudy): Trial {\n  const { protocolSection } = study;\n  const { identificationModule, statusModule } = protocolSection;\n\n  const nctId = identificationModule.nctId;\n\n  // Extract locations (US only)\n  const rawLocations = protocolSection.contactsLocationsModule?.locations || [];\n  const locations: Location[] = rawLocations\n    .filter((loc) => loc.country === 'United States')\n    .map((loc) => ({\n      facility: loc.facility || 'Unknown Facility',\n      city: loc.city || '',\n      state: loc.state || '',\n      zipcode: loc.zip || '',\n    }));\n\n  // Extract interventions\n  const interventions =\n    protocolSection.armsInterventionsModule?.interventions?.map((i) => i.name) || [];\n\n  return {\n    nctId,\n    title: identificationModule.briefTitle,\n    phase: mapPhase(protocolSection.designModule?.phases),\n    status: statusModule.overallStatus,\n    sponsor: protocolSection.sponsorCollaboratorsModule?.leadSponsor?.name || 'Unknown',\n    conditions: protocolSection.conditionsModule?.conditions || [],\n    interventions,\n    locations,\n    url: `https://clinicaltrials.gov/study/${nctId}`,\n  };\n}\n\n// ============================================================================\n// Main Agent Function\n// ============================================================================\n\n/**\n * Run the Clinical Trial Scout agent\n * Discovers actively recruiting trials matching patient condition and location\n */\nexport async function runScoutAgent(input: ScoutInput): Promise<TrialDiscoveryOutput> {\n  const { diagnosis, zipcode, travelRadiusMiles, phase } = input;\n\n  try {\n    // Query ClinicalTrials.gov API\n    const response = await queryClinicalTrials(\n      diagnosis,\n      zipcode,\n      travelRadiusMiles,\n      phase\n    );\n\n    if (!response.studies || response.studies.length === 0) {\n      return {\n        trials: [],\n        totalFound: 0,\n        searchParams: {\n          diagnosis,\n          zipcode,\n          travelRadiusMiles,\n          phase,\n        },\n      };\n    }\n\n    // Transform studies to trials\n    let trials = response.studies.map(transformStudyToTrial);\n\n    // Filter by location radius and add distances\n    trials = trials.map((trial) => {\n      if (trial.locations.length === 0) {\n        return trial;\n      }\n\n      const filteredLocations = filterByRadius(trial.locations, zipcode, travelRadiusMiles);\n\n      // If no locations match the radius, keep original locations with estimated distances\n      if (filteredLocations.length === 0) {\n        return {\n          ...trial,\n          locations: addDistanceToLocations(trial.locations, zipcode),\n        };\n      }\n\n      return {\n        ...trial,\n        locations: filteredLocations,\n      };\n    });\n\n    // Keep all trials (don't filter out based on location for mock data)\n    // trials = trials.filter((trial) => trial.locations.length > 0);\n\n    // Sort by closest location distance\n    trials.sort((a, b) => {\n      const distA = a.locations[0]?.distance ?? Infinity;\n      const distB = b.locations[0]?.distance ?? Infinity;\n      return distA - distB;\n    });\n\n    // Limit to top N trials\n    const topTrials = trials.slice(0, MAX_TRIALS_TO_RETURN);\n\n    return {\n      trials: topTrials,\n      totalFound: response.totalCount,\n      searchParams: {\n        diagnosis,\n        zipcode,\n        travelRadiusMiles,\n        phase,\n      },\n    };\n  } catch (error) {\n    console.error('Scout agent error:', error);\n\n    // Return empty results on error\n    return {\n      trials: [],\n      totalFound: 0,\n      searchParams: {\n        diagnosis,\n        zipcode,\n        travelRadiusMiles,\n        phase,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n// ============================================================================\n// Retry Wrapper\n// ============================================================================\n\n/**\n * Run scout agent with retry logic\n */\nexport async function runScoutAgentWithRetry(\n  input: ScoutInput,\n  maxRetries: number = 2\n): Promise<TrialDiscoveryOutput> {\n  let lastError: Error | undefined;\n\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      return await runScoutAgent(input);\n    } catch (error) {\n      lastError = error instanceof Error ? error : new Error(String(error));\n\n      if (attempt < maxRetries) {\n        // Wait before retry (exponential backoff)\n        await new Promise((resolve) => setTimeout(resolve, 1000 * Math.pow(2, attempt)));\n      }\n    }\n  }\n\n  // Return empty results after all retries failed\n  return {\n    trials: [],\n    totalFound: 0,\n    searchParams: {\n      ...input,\n      error: lastError?.message || 'Failed after retries',\n    },\n  };\n}\n","import type {\n  ExtractorInput,\n  EligibilityCriteria,\n  CriteriaCategory,\n} from '../../lib/schemas';\n\n// Use mock data in development to avoid API issues\nconst USE_MOCK_DATA = true;\n\n// ============================================================================\n// Mock Eligibility Data\n// ============================================================================\n\nfunction getMockEligibility(nctId: string): EligibilityCriteria {\n  const mockCriteria: Record<string, EligibilityCriteria> = {\n    'NCT04613596': {\n      nctId,\n      inclusionCriteria: [\n        { criterion: 'Histologically confirmed non-small cell lung cancer', category: 'diagnosis' },\n        { criterion: 'Stage IIIB or IV disease', category: 'diagnosis' },\n        { criterion: 'ECOG performance status 0-1', category: 'other' },\n        { criterion: 'At least one measurable lesion per RECIST 1.1', category: 'other' },\n        { criterion: 'Adequate organ function', category: 'other' },\n      ],\n      exclusionCriteria: [\n        { criterion: 'Prior therapy with anti-PD-1 or anti-PD-L1 agents', category: 'treatment' },\n        { criterion: 'Active autoimmune disease requiring systemic treatment', category: 'other' },\n        { criterion: 'Known EGFR or ALK genomic alterations', category: 'biomarker' },\n      ],\n      ageRange: { min: 18, max: 120 },\n      acceptsHealthyVolunteers: false,\n      rawText: '',\n    },\n    'NCT05502913': {\n      nctId,\n      inclusionCriteria: [\n        { criterion: 'Advanced or metastatic NSCLC', category: 'diagnosis' },\n        { criterion: 'EGFR mutation positive (Ex19del or L858R)', category: 'biomarker' },\n        { criterion: 'ECOG performance status 0-2', category: 'other' },\n        { criterion: 'No prior EGFR TKI therapy', category: 'treatment' },\n      ],\n      exclusionCriteria: [\n        { criterion: 'Brain metastases unless treated and stable', category: 'diagnosis' },\n        { criterion: 'Prior treatment with osimertinib', category: 'treatment' },\n      ],\n      ageRange: { min: 18, max: 120 },\n      acceptsHealthyVolunteers: false,\n      rawText: '',\n    },\n    'NCT04487587': {\n      nctId,\n      inclusionCriteria: [\n        { criterion: 'Histologically confirmed NSCLC', category: 'diagnosis' },\n        { criterion: 'PD-L1 expression >= 1%', category: 'biomarker' },\n        { criterion: 'No prior systemic therapy for metastatic disease', category: 'treatment' },\n        { criterion: 'ECOG performance status 0-1', category: 'other' },\n      ],\n      exclusionCriteria: [\n        { criterion: 'EGFR or ALK positive mutations', category: 'biomarker' },\n        { criterion: 'Active infection requiring systemic therapy', category: 'other' },\n      ],\n      ageRange: { min: 18, max: 85 },\n      acceptsHealthyVolunteers: false,\n      rawText: '',\n    },\n    'NCT05789108': {\n      nctId,\n      inclusionCriteria: [\n        { criterion: 'Relapsed or refractory NSCLC', category: 'diagnosis' },\n        { criterion: 'Failed at least 2 prior lines of therapy', category: 'treatment' },\n        { criterion: 'ECOG performance status 0-1', category: 'other' },\n        { criterion: 'Adequate bone marrow function', category: 'other' },\n      ],\n      exclusionCriteria: [\n        { criterion: 'Prior CAR-T therapy', category: 'treatment' },\n        { criterion: 'Active CNS involvement', category: 'diagnosis' },\n      ],\n      ageRange: { min: 18, max: 75 },\n      acceptsHealthyVolunteers: false,\n      rawText: '',\n    },\n    'NCT04721444': {\n      nctId,\n      inclusionCriteria: [\n        { criterion: 'Advanced NSCLC with confirmed EGFR mutation', category: 'biomarker' },\n        { criterion: 'Stage IIIB/IV disease', category: 'diagnosis' },\n        { criterion: 'ECOG performance status 0-2', category: 'other' },\n      ],\n      exclusionCriteria: [\n        { criterion: 'T790M resistance mutation', category: 'biomarker' },\n        { criterion: 'Prior EGFR TKI within 14 days', category: 'treatment' },\n      ],\n      ageRange: { min: 18, max: 120 },\n      acceptsHealthyVolunteers: false,\n      rawText: '',\n    },\n  };\n\n  return mockCriteria[nctId] || {\n    nctId,\n    inclusionCriteria: [\n      { criterion: 'Confirmed cancer diagnosis', category: 'diagnosis' as CriteriaCategory },\n      { criterion: 'ECOG 0-2', category: 'other' as CriteriaCategory },\n    ],\n    exclusionCriteria: [\n      { criterion: 'Prior experimental therapy within 30 days', category: 'treatment' as CriteriaCategory },\n    ],\n    ageRange: { min: 18, max: 120 },\n    acceptsHealthyVolunteers: false,\n    rawText: '',\n  };\n}\n\n// ============================================================================\n// Main Agent Function\n// ============================================================================\n\n/**\n * Run the Eligibility Extractor agent\n * Extracts and parses eligibility criteria from trial pages\n */\nexport async function runExtractorAgent(\n  input: ExtractorInput\n): Promise<EligibilityCriteria> {\n  const { nctId } = input;\n\n  // Use mock data to avoid API issues in browser\n  if (USE_MOCK_DATA) {\n    console.log(`Using mock eligibility data for ${nctId}`);\n    await new Promise((resolve) => setTimeout(resolve, 500)); // Simulate delay\n    return getMockEligibility(nctId);\n  }\n\n  // Fallback - return default criteria\n  return getMockEligibility(nctId);\n}\n\n// ============================================================================\n// Batch Extraction\n// ============================================================================\n\n/**\n * Extract eligibility for multiple trials in parallel\n */\nexport async function runExtractorAgentBatch(\n  inputs: ExtractorInput[],\n  concurrency: number = 3\n): Promise<Map<string, EligibilityCriteria>> {\n  const results = new Map<string, EligibilityCriteria>();\n\n  // Process in batches\n  for (let i = 0; i < inputs.length; i += concurrency) {\n    const batch = inputs.slice(i, i + concurrency);\n    const batchResults = await Promise.all(\n      batch.map((input) => runExtractorAgent(input))\n    );\n\n    batch.forEach((input, idx) => {\n      results.set(input.nctId, batchResults[idx]);\n    });\n  }\n\n  return results;\n}\n","import { createToolhouseClient, runAgent } from '../../lib/toolhouse';\nimport type {\n  MatcherInput,\n  MatchResult,\n  MatchCategory,\n  MatchingFactor,\n  BlockingFactor,\n  PatientProfile,\n  EligibilityCriteria,\n} from '../../lib/schemas';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface LLMMatchResponse {\n  score: number;\n  category: MatchCategory;\n  matchingFactors: MatchingFactor[];\n  blockingFactors: BlockingFactor[];\n  uncertainFactors: string[];\n  summary: string;\n}\n\n// ============================================================================\n// Weight Configuration\n// ============================================================================\n\nconst CRITERIA_WEIGHTS: Record<string, number> = {\n  diagnosis: 10,\n  biomarker: 9,\n  stage: 8,\n  ecog: 7,\n  treatment: 6,\n  demographics: 5,\n  other: 3,\n};\n\n// ============================================================================\n// Matching Logic\n// ============================================================================\n\n/**\n * Check ECOG score against criteria\n */\nfunction checkECOG(\n  patientECOG: number,\n  criteria: EligibilityCriteria\n): { match: boolean; reason?: string } {\n  // Look for ECOG requirements in criteria\n  const ecogCriteria = [\n    ...criteria.inclusionCriteria,\n    ...criteria.exclusionCriteria,\n  ].find((c) => /ecog|performance status/i.test(c.criterion));\n\n  if (!ecogCriteria) {\n    return { match: true }; // No ECOG requirement found\n  }\n\n  // Try to extract ECOG requirement\n  const ecogMatch = ecogCriteria.criterion.match(/ecog\\s*(?:ps|score)?\\s*(?:of\\s*)?(\\d)(?:\\s*-\\s*(\\d))?/i);\n\n  if (ecogMatch) {\n    const minECOG = parseInt(ecogMatch[1], 10);\n    const maxECOG = ecogMatch[2] ? parseInt(ecogMatch[2], 10) : minECOG;\n\n    if (patientECOG >= minECOG && patientECOG <= maxECOG) {\n      return { match: true };\n    }\n\n    return {\n      match: false,\n      reason: `ECOG score ${patientECOG} outside required range (${minECOG}-${maxECOG})`,\n    };\n  }\n\n  return { match: true }; // Couldn't parse requirement, assume match\n}\n\n/**\n * Check biomarker alignment\n */\nfunction checkBiomarkers(\n  patientBiomarkers: string[],\n  criteria: EligibilityCriteria\n): { matches: string[]; conflicts: string[]; uncertain: string[] } {\n  const matches: string[] = [];\n  const conflicts: string[] = [];\n  const uncertain: string[] = [];\n\n  const biomarkerCriteria = criteria.inclusionCriteria.filter(\n    (c) => c.category === 'biomarker'\n  );\n  const excludedBiomarkers = criteria.exclusionCriteria.filter(\n    (c) => c.category === 'biomarker'\n  );\n\n  // Normalize biomarkers for comparison\n  const normalize = (s: string) => s.toLowerCase().replace(/[^a-z0-9]/g, '');\n  const normalizedPatient = patientBiomarkers.map(normalize);\n\n  // Check inclusion criteria\n  for (const criterion of biomarkerCriteria) {\n    const criterionNorm = normalize(criterion.criterion);\n\n    const hasMatch = normalizedPatient.some(\n      (pb) => criterionNorm.includes(pb) || pb.includes(criterionNorm)\n    );\n\n    if (hasMatch) {\n      matches.push(criterion.criterion);\n    } else {\n      uncertain.push(criterion.criterion);\n    }\n  }\n\n  // Check exclusion criteria\n  for (const criterion of excludedBiomarkers) {\n    const criterionNorm = normalize(criterion.criterion);\n\n    const hasConflict = normalizedPatient.some(\n      (pb) => criterionNorm.includes(pb) || pb.includes(criterionNorm)\n    );\n\n    if (hasConflict) {\n      conflicts.push(criterion.criterion);\n    }\n  }\n\n  return { matches, conflicts, uncertain };\n}\n\n/**\n * Check treatment history alignment\n */\nfunction checkTreatmentHistory(\n  previousTreatments: string[],\n  criteria: EligibilityCriteria\n): { matches: string[]; conflicts: string[] } {\n  const matches: string[] = [];\n  const conflicts: string[] = [];\n\n  const treatmentInclusion = criteria.inclusionCriteria.filter(\n    (c) => c.category === 'treatment'\n  );\n  const treatmentExclusion = criteria.exclusionCriteria.filter(\n    (c) => c.category === 'treatment'\n  );\n\n  const normalizedTreatments = previousTreatments.map((t) =>\n    t.toLowerCase().replace(/[^a-z0-9]/g, '')\n  );\n\n  // Check if prior treatment is required\n  for (const criterion of treatmentInclusion) {\n    if (/prior|previous|must have received/i.test(criterion.criterion)) {\n      const required = criterion.criterion.toLowerCase();\n      const hasRequired = normalizedTreatments.some((t) => required.includes(t));\n\n      if (hasRequired) {\n        matches.push(`Prior ${criterion.criterion.slice(0, 50)}...`);\n      }\n    }\n  }\n\n  // Check for excluded treatments\n  for (const criterion of treatmentExclusion) {\n    const excluded = criterion.criterion.toLowerCase();\n    const hasExcluded = normalizedTreatments.some((t) => excluded.includes(t));\n\n    if (hasExcluded) {\n      conflicts.push(`Excluded: ${criterion.criterion.slice(0, 50)}...`);\n    }\n  }\n\n  return { matches, conflicts };\n}\n\n// ============================================================================\n// Score Calculation\n// ============================================================================\n\n/**\n * Calculate match score and category\n */\nfunction calculateScore(\n  matchingFactors: MatchingFactor[],\n  blockingFactors: BlockingFactor[],\n  uncertainFactors: string[]\n): { score: number; category: MatchCategory } {\n  // If there are hard exclusions, score is very low\n  if (blockingFactors.length > 0) {\n    const score = Math.max(0, 20 - blockingFactors.length * 10);\n    return { score, category: 'not_eligible' };\n  }\n\n  // Calculate weighted score from matching factors\n  const totalWeight = matchingFactors.reduce((sum, f) => sum + f.weight, 0);\n  const maxPossibleWeight = Object.values(CRITERIA_WEIGHTS).reduce((a, b) => a + b, 0);\n\n  // Penalize for uncertain factors\n  const uncertaintyPenalty = uncertainFactors.length * 5;\n\n  let score = Math.round((totalWeight / maxPossibleWeight) * 100) - uncertaintyPenalty;\n  score = Math.max(0, Math.min(100, score));\n\n  // Determine category\n  let category: MatchCategory;\n  if (score >= 75) {\n    category = 'strong_match';\n  } else if (score >= 50) {\n    category = 'possible_match';\n  } else if (score >= 25) {\n    category = 'future_potential';\n  } else {\n    category = 'not_eligible';\n  }\n\n  return { score, category };\n}\n\n// ============================================================================\n// Summary Generation\n// ============================================================================\n\n/**\n * Generate plain-language summary\n */\nfunction generateSummary(\n  category: MatchCategory,\n  matchingFactors: MatchingFactor[],\n  blockingFactors: BlockingFactor[]\n): string {\n  if (category === 'not_eligible' && blockingFactors.length > 0) {\n    const mainReason = blockingFactors[0].reason;\n    return `This trial may not be a good fit right now. ${mainReason}. Consider discussing alternative options with your doctor.`;\n  }\n\n  if (category === 'strong_match') {\n    const topFactor = matchingFactors[0]?.factor || 'your profile';\n    return `This trial looks like a strong match for you. ${topFactor} aligns well with what the trial is looking for. Talk to your doctor about whether this could be a good option.`;\n  }\n\n  if (category === 'possible_match') {\n    return `This trial could potentially be a fit for you. Some of your information matches what they're looking for, but a few details would need to be confirmed. Your doctor can help determine if you qualify.`;\n  }\n\n  // future_potential\n  return `This trial might become an option in the future. Right now, there are some differences between your situation and what the trial requires. Your doctor can explain more about what might need to change.`;\n}\n\n// ============================================================================\n// Main Agent Function\n// ============================================================================\n\n// Skip LLM calls in development\nconst USE_RULES_ONLY = true;\n\n/**\n * Run the Clinical Matcher agent\n * Compares patient profile against eligibility criteria\n */\nexport async function runMatcherAgent(input: MatcherInput): Promise<MatchResult> {\n  const { patientProfile, eligibilityCriteria, nctId } = input;\n\n  console.log(`Matching patient against trial ${nctId}`);\n\n  // Simulate processing delay\n  await new Promise((resolve) => setTimeout(resolve, 300));\n\n  if (!USE_RULES_ONLY) {\n    try {\n      // Try LLM-based matching first for better accuracy\n      const llmResult = await matchWithLLM(patientProfile, eligibilityCriteria, nctId);\n\n      if (llmResult) {\n        return llmResult;\n      }\n    } catch (error) {\n      console.warn('LLM matching failed, using rule-based fallback:', error);\n    }\n  }\n\n  // Use rule-based matching\n  return matchWithRules(patientProfile, eligibilityCriteria, nctId);\n}\n\n/**\n * LLM-based matching using Toolhouse\n */\nasync function matchWithLLM(\n  profile: PatientProfile,\n  criteria: EligibilityCriteria,\n  nctId: string\n): Promise<MatchResult | null> {\n  const client = createToolhouseClient();\n\n  const result = await runAgent<LLMMatchResponse>(client, 'clinical-matcher', {\n    patientProfile: profile,\n    eligibilityCriteria: criteria,\n    nctId,\n  });\n\n  if (result.success && result.output) {\n    return {\n      nctId,\n      ...result.output,\n    };\n  }\n\n  return null;\n}\n\n/**\n * Rule-based matching as fallback\n */\nfunction matchWithRules(\n  profile: PatientProfile,\n  criteria: EligibilityCriteria,\n  nctId: string\n): MatchResult {\n  const matchingFactors: MatchingFactor[] = [];\n  const blockingFactors: BlockingFactor[] = [];\n  const uncertainFactors: string[] = [];\n\n  // Check ECOG\n  const ecogResult = checkECOG(profile.ecogScore, criteria);\n  if (ecogResult.match) {\n    matchingFactors.push({\n      factor: `ECOG score ${profile.ecogScore} meets requirements`,\n      weight: CRITERIA_WEIGHTS.ecog,\n    });\n  } else if (ecogResult.reason) {\n    blockingFactors.push({\n      factor: 'ECOG Score',\n      reason: ecogResult.reason,\n    });\n  }\n\n  // Check biomarkers\n  const biomarkerResult = checkBiomarkers(profile.biomarkers, criteria);\n  biomarkerResult.matches.forEach((match) => {\n    matchingFactors.push({\n      factor: `Biomarker match: ${match.slice(0, 40)}`,\n      weight: CRITERIA_WEIGHTS.biomarker,\n    });\n  });\n  biomarkerResult.conflicts.forEach((conflict) => {\n    blockingFactors.push({\n      factor: 'Biomarker',\n      reason: conflict,\n    });\n  });\n  uncertainFactors.push(...biomarkerResult.uncertain.map((u) => u.slice(0, 50)));\n\n  // Check treatment history\n  const treatmentResult = checkTreatmentHistory(\n    profile.previousTreatments,\n    criteria\n  );\n  treatmentResult.matches.forEach((match) => {\n    matchingFactors.push({\n      factor: match,\n      weight: CRITERIA_WEIGHTS.treatment,\n    });\n  });\n  treatmentResult.conflicts.forEach((conflict) => {\n    blockingFactors.push({\n      factor: 'Treatment History',\n      reason: conflict,\n    });\n  });\n\n  // Check diagnosis match (basic)\n  const diagnosisCriteria = criteria.inclusionCriteria.filter(\n    (c) => c.category === 'diagnosis'\n  );\n  if (diagnosisCriteria.length > 0) {\n    const diagnosisLower = profile.diagnosis.toLowerCase();\n    const hasMatch = diagnosisCriteria.some((c) =>\n      c.criterion.toLowerCase().includes(diagnosisLower) ||\n      diagnosisLower.includes(c.criterion.toLowerCase().split(' ')[0])\n    );\n\n    if (hasMatch) {\n      matchingFactors.push({\n        factor: `Diagnosis matches trial requirements`,\n        weight: CRITERIA_WEIGHTS.diagnosis,\n      });\n    } else {\n      uncertainFactors.push('Diagnosis alignment needs confirmation');\n    }\n  }\n\n  // Calculate score\n  const { score, category } = calculateScore(\n    matchingFactors,\n    blockingFactors,\n    uncertainFactors\n  );\n\n  // Generate summary\n  const summary = generateSummary(category, matchingFactors, blockingFactors);\n\n  return {\n    nctId,\n    score,\n    category,\n    matchingFactors,\n    blockingFactors,\n    uncertainFactors,\n    summary,\n  };\n}\n\n// ============================================================================\n// Batch Matching\n// ============================================================================\n\n/**\n * Match patient against multiple trials\n */\nexport async function runMatcherAgentBatch(\n  profile: PatientProfile,\n  criteriaList: Array<{ nctId: string; criteria: EligibilityCriteria }>,\n  concurrency: number = 5\n): Promise<MatchResult[]> {\n  const results: MatchResult[] = [];\n\n  // Process in parallel with limited concurrency\n  const batches: Array<typeof criteriaList> = [];\n  for (let i = 0; i < criteriaList.length; i += concurrency) {\n    batches.push(criteriaList.slice(i, i + concurrency));\n  }\n\n  for (const batch of batches) {\n    const batchResults = await Promise.all(\n      batch.map(({ nctId, criteria }) =>\n        runMatcherAgent({\n          patientProfile: profile,\n          eligibilityCriteria: criteria,\n          nctId,\n        })\n      )\n    );\n    results.push(...batchResults);\n  }\n\n  return results;\n}\n","import { getElevenLabsApiKey } from './config';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ElevenLabsClient {\n  apiKey: string;\n  baseUrl: string;\n}\n\nexport interface SpeechOptions {\n  voiceId?: string;\n  language?: 'en' | 'es' | 'zh' | 'fr' | 'de';\n  stability?: number;\n  similarityBoost?: number;\n}\n\nexport interface AudioResult {\n  audioUrl: string;\n  duration: number;\n  format: 'mp3';\n}\n\n// ============================================================================\n// Voice Configuration\n// ============================================================================\n\n// Map language codes to appropriate ElevenLabs voice IDs\nconst VOICE_MAP: Record<string, string> = {\n  en: '21m00Tcm4TlvDq8ikWAM', // Rachel - warm, clear English\n  es: 'AZnzlk1XvdvUeBnXmlld', // Spanish voice\n  zh: 'g5CIjZEefAph4nQFvHAz', // Chinese voice\n  fr: 'XrExE9yKIg1WjnnlVkGX', // French voice\n  de: 'Yko7PKHZNXotIFUBG7I9', // German voice\n};\n\nconst DEFAULT_VOICE_ID = VOICE_MAP['en'];\nconst MODEL_ID = 'eleven_flash_v2_5'; // Low latency model\nconst MAX_TEXT_LENGTH = 5000;\n\n// ============================================================================\n// Client Creation\n// ============================================================================\n\n/**\n * Create an ElevenLabs client for text-to-speech\n */\nexport function createElevenLabsClient(apiKey?: string): ElevenLabsClient {\n  const key = apiKey || getElevenLabsApiKey();\n\n  return {\n    apiKey: key,\n    baseUrl: 'https://api.elevenlabs.io/v1',\n  };\n}\n\n// ============================================================================\n// Duration Estimation\n// ============================================================================\n\n/**\n * Estimate audio duration from text length\n * Average speaking rate: ~150 words per minute\n */\nfunction estimateDuration(text: string): number {\n  const wordCount = text.split(/\\s+/).length;\n  const minutesDuration = wordCount / 150;\n  return Math.round(minutesDuration * 60); // Convert to seconds\n}\n\n// ============================================================================\n// Text Processing\n// ============================================================================\n\n/**\n * Split long text into chunks for processing\n */\nfunction splitTextIntoChunks(text: string, maxLength: number = MAX_TEXT_LENGTH): string[] {\n  if (text.length <= maxLength) {\n    return [text];\n  }\n\n  const chunks: string[] = [];\n  const sentences = text.split(/(?<=[.!?])\\s+/);\n  let currentChunk = '';\n\n  for (const sentence of sentences) {\n    if ((currentChunk + sentence).length > maxLength) {\n      if (currentChunk) {\n        chunks.push(currentChunk.trim());\n      }\n      currentChunk = sentence;\n    } else {\n      currentChunk += (currentChunk ? ' ' : '') + sentence;\n    }\n  }\n\n  if (currentChunk) {\n    chunks.push(currentChunk.trim());\n  }\n\n  return chunks;\n}\n\n// ============================================================================\n// Speech Synthesis\n// ============================================================================\n\n/**\n * Synthesize speech from text using ElevenLabs API\n */\nexport async function synthesizeSpeech(\n  client: ElevenLabsClient,\n  text: string,\n  options: SpeechOptions = {}\n): Promise<AudioResult> {\n  const {\n    voiceId,\n    language = 'en',\n    stability = 0.5,\n    similarityBoost = 0.75,\n  } = options;\n\n  // Select voice based on language if not explicitly provided\n  const selectedVoiceId = voiceId || VOICE_MAP[language] || DEFAULT_VOICE_ID;\n\n  // Handle long text\n  const chunks = splitTextIntoChunks(text);\n\n  if (chunks.length === 1) {\n    return synthesizeChunk(client, chunks[0], selectedVoiceId, stability, similarityBoost);\n  }\n\n  // For multiple chunks, synthesize and combine\n  const audioBlobs: Blob[] = [];\n  let totalDuration = 0;\n\n  for (const chunk of chunks) {\n    const result = await synthesizeChunk(\n      client,\n      chunk,\n      selectedVoiceId,\n      stability,\n      similarityBoost\n    );\n\n    const response = await fetch(result.audioUrl);\n    const blob = await response.blob();\n    audioBlobs.push(blob);\n    totalDuration += result.duration;\n  }\n\n  // Combine audio blobs\n  const combinedBlob = new Blob(audioBlobs, { type: 'audio/mpeg' });\n  const audioUrl = URL.createObjectURL(combinedBlob);\n\n  return {\n    audioUrl,\n    duration: totalDuration,\n    format: 'mp3',\n  };\n}\n\n/**\n * Synthesize a single chunk of text\n */\nasync function synthesizeChunk(\n  client: ElevenLabsClient,\n  text: string,\n  voiceId: string,\n  stability: number,\n  similarityBoost: number\n): Promise<AudioResult> {\n  const url = `${client.baseUrl}/text-to-speech/${voiceId}`;\n\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'xi-api-key': client.apiKey,\n      },\n      body: JSON.stringify({\n        text,\n        model_id: MODEL_ID,\n        voice_settings: {\n          stability,\n          similarity_boost: similarityBoost,\n        },\n      }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n\n      if (response.status === 401) {\n        throw new Error('Invalid ElevenLabs API key');\n      }\n      if (response.status === 429) {\n        throw new Error('ElevenLabs rate limit exceeded. Character quota may be depleted.');\n      }\n      if (response.status === 400) {\n        throw new Error('Text is too long or contains invalid characters');\n      }\n\n      throw new Error(\n        `ElevenLabs API error: ${response.statusText} - ${JSON.stringify(errorData)}`\n      );\n    }\n\n    // Get audio blob and create URL\n    const audioBlob = await response.blob();\n    const audioUrl = URL.createObjectURL(audioBlob);\n\n    return {\n      audioUrl,\n      duration: estimateDuration(text),\n      format: 'mp3',\n    };\n  } catch (error) {\n    if (error instanceof Error) {\n      throw error;\n    }\n    throw new Error('Failed to synthesize speech');\n  }\n}\n\n// ============================================================================\n// Voice Management\n// ============================================================================\n\n/**\n * Get available voices for a language\n */\nexport function getVoiceForLanguage(language: string): string {\n  return VOICE_MAP[language] || DEFAULT_VOICE_ID;\n}\n\n/**\n * List supported languages\n */\nexport function getSupportedLanguages(): string[] {\n  return Object.keys(VOICE_MAP);\n}\n\n// ============================================================================\n// Audio URL Management\n// ============================================================================\n\n/**\n * Revoke a blob URL to free memory\n */\nexport function revokeAudioUrl(url: string): void {\n  if (url.startsWith('blob:')) {\n    URL.revokeObjectURL(url);\n  }\n}\n\n// ============================================================================\n// Stream Support (for future use)\n// ============================================================================\n\n/**\n * Synthesize speech with streaming (returns ReadableStream)\n */\nexport async function synthesizeSpeechStream(\n  client: ElevenLabsClient,\n  text: string,\n  options: SpeechOptions = {}\n): Promise<ReadableStream<Uint8Array> | null> {\n  const { voiceId, language = 'en', stability = 0.5, similarityBoost = 0.75 } = options;\n\n  const selectedVoiceId = voiceId || VOICE_MAP[language] || DEFAULT_VOICE_ID;\n  const url = `${client.baseUrl}/text-to-speech/${selectedVoiceId}/stream`;\n\n  const response = await fetch(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'xi-api-key': client.apiKey,\n    },\n    body: JSON.stringify({\n      text,\n      model_id: MODEL_ID,\n      voice_settings: {\n        stability,\n        similarity_boost: similarityBoost,\n      },\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Stream synthesis failed: ${response.statusText}`);\n  }\n\n  return response.body;\n}\n","import {\n  createElevenLabsClient,\n  synthesizeSpeech,\n  getVoiceForLanguage,\n} from '../../lib/elevenlabs';\nimport type {\n  AdvocateInput,\n  VoiceScript,\n  MatchResult,\n} from '../../lib/schemas';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst REQUIRED_DISCLAIMER =\n  'This information is for educational purposes only and should not replace professional medical advice. ' +\n  'Please discuss these options with your healthcare provider before making any decisions about clinical trial participation.';\n\nconst LANGUAGE_GREETINGS: Record<string, string> = {\n  en: 'Hello',\n  es: 'Hola',\n  zh: '',\n  fr: 'Bonjour',\n  de: 'Guten Tag',\n};\n\n// ============================================================================\n// Script Templates\n// ============================================================================\n\nfunction getStrongMatchTemplate(\n  topMatches: MatchResult[],\n  language: string\n): string {\n  const greeting = LANGUAGE_GREETINGS[language] || 'Hello';\n  const match = topMatches[0];\n\n  return `${greeting}. I've found some promising clinical trial options that could be a good fit for you.\n\nThe top match is a trial that scores ${match.score} out of 100. ${match.summary}\n\n${topMatches.length > 1 ? `I also found ${topMatches.length - 1} other strong matches worth discussing with your doctor.` : ''}\n\nHere's what I recommend as next steps: First, print or save these results. Then, schedule a conversation with your oncologist or care team to review these options together. They can help determine which trial, if any, might be right for your specific situation.\n\nRemember: ${REQUIRED_DISCLAIMER}`;\n}\n\nfunction getPossibleMatchTemplate(\n  matches: MatchResult[],\n  language: string\n): string {\n  const greeting = LANGUAGE_GREETINGS[language] || 'Hello';\n\n  return `${greeting}. I've reviewed available clinical trials and found some possible options worth exploring.\n\nI found ${matches.length} trials that could potentially be a fit for you. While they're not perfect matches, they're worth discussing with your doctor. Some details about your medical history would need to be confirmed to determine final eligibility.\n\nYour next step is to share these results with your healthcare team. They know your complete medical history and can help identify which trials, if any, make sense to pursue.\n\n${REQUIRED_DISCLAIMER}`;\n}\n\nfunction getNoStrongMatchTemplate(language: string): string {\n  const greeting = LANGUAGE_GREETINGS[language] || 'Hello';\n\n  return `${greeting}. I've searched through available clinical trials, and while I didn't find a strong match right now, please don't be discouraged.\n\nClinical trials are constantly opening and closing, and new options become available regularly. Your situation may also change over time, which could open up new possibilities.\n\nHere's what you can do: Talk to your doctor about other treatment options available to you. You might also consider checking back in a few months, as new trials often open up.\n\nStay hopeful, and remember that you have a healthcare team supporting you through this journey.\n\n${REQUIRED_DISCLAIMER}`;\n}\n\n// ============================================================================\n// Script Generation\n// ============================================================================\n\n/**\n * Generate script from templates\n */\nfunction generateScriptFromTemplate(\n  matchResults: MatchResult[],\n  language: string\n): string {\n  const strongMatches = matchResults.filter((m) => m.category === 'strong_match');\n  const possibleMatches = matchResults.filter((m) => m.category === 'possible_match');\n\n  if (strongMatches.length > 0) {\n    return getStrongMatchTemplate(strongMatches, language);\n  }\n\n  if (possibleMatches.length > 0) {\n    return getPossibleMatchTemplate(possibleMatches, language);\n  }\n\n  return getNoStrongMatchTemplate(language);\n}\n\n// ============================================================================\n// Main Agent Function\n// ============================================================================\n\n// Enable audio synthesis with ElevenLabs\nconst SKIP_AUDIO_SYNTHESIS = false;\n\n/**\n * Run the Patient Advocate agent\n * Generates compassionate voice scripts and synthesizes audio\n */\nexport async function runAdvocateAgent(input: AdvocateInput): Promise<VoiceScript> {\n  const { matchResults, language = 'en' } = input;\n\n  console.log('Generating patient advocate script...');\n\n  // Simulate processing delay\n  await new Promise((resolve) => setTimeout(resolve, 800));\n\n  // Generate script text from template\n  let scriptText = generateScriptFromTemplate(matchResults, language);\n\n  // Ensure disclaimer is included\n  if (!scriptText.includes('educational purposes only')) {\n    scriptText += `\\n\\n${REQUIRED_DISCLAIMER}`;\n  }\n\n  // Skip audio synthesis in development\n  if (SKIP_AUDIO_SYNTHESIS) {\n    return {\n      text: scriptText,\n      audioUrl: '', // No audio in development\n      duration: estimateDuration(scriptText),\n      language,\n    };\n  }\n\n  // Synthesize audio\n  try {\n    const elevenLabsClient = createElevenLabsClient();\n    const audioResult = await synthesizeSpeech(elevenLabsClient, scriptText, {\n      language: language as 'en' | 'es' | 'zh' | 'fr' | 'de',\n      voiceId: getVoiceForLanguage(language),\n      stability: 0.5,\n      similarityBoost: 0.75,\n    });\n\n    return {\n      text: scriptText,\n      audioUrl: audioResult.audioUrl,\n      duration: audioResult.duration,\n      language,\n    };\n  } catch (audioError) {\n    console.error('Audio synthesis failed:', audioError);\n\n    // Return script without audio\n    return {\n      text: scriptText,\n      audioUrl: '',\n      duration: estimateDuration(scriptText),\n      language,\n    };\n  }\n}\n\n/**\n * Estimate spoken duration from text\n */\nfunction estimateDuration(text: string): number {\n  const wordCount = text.split(/\\s+/).length;\n  return Math.round((wordCount / 150) * 60); // ~150 words per minute\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Validate that script meets requirements\n */\nexport function validateScript(script: string): {\n  valid: boolean;\n  issues: string[];\n} {\n  const issues: string[] = [];\n\n  // Check word count\n  const wordCount = script.split(/\\s+/).length;\n  if (wordCount < 100) {\n    issues.push('Script too short (< 100 words)');\n  }\n  if (wordCount > 300) {\n    issues.push('Script too long (> 300 words)');\n  }\n\n  // Check for disclaimer\n  if (!script.includes('educational purposes')) {\n    issues.push('Missing required disclaimer');\n  }\n\n  // Check reading level (basic Flesch-Kincaid approximation)\n  const sentences = script.split(/[.!?]+/).filter((s) => s.trim().length > 0);\n  const avgWordsPerSentence = wordCount / sentences.length;\n  if (avgWordsPerSentence > 25) {\n    issues.push('Sentences too complex for 8th-grade reading level');\n  }\n\n  return {\n    valid: issues.length === 0,\n    issues,\n  };\n}\n","import { runScoutAgent } from '../agents/scout';\nimport { runExtractorAgent } from '../agents/extractor';\nimport { runMatcherAgent } from '../agents/matcher';\nimport { runAdvocateAgent } from '../agents/advocate';\nimport type {\n  PatientProfile,\n  PipelineResult,\n  PipelineStep,\n  MatchResult,\n  VoiceScript,\n  EligibilityCriteria,\n} from './schemas';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type ProgressCallback = (step: PipelineStep, logs?: string[]) => void;\n\nexport interface PipelineOptions {\n  maxTrials?: number;\n  concurrency?: number;\n  abortSignal?: AbortSignal;\n}\n\n// ============================================================================\n// Pipeline Steps Configuration\n// ============================================================================\n\nconst PIPELINE_STEPS: Omit<PipelineStep, 'status'>[] = [\n  { id: 'scout', name: 'Finding Trials' },\n  { id: 'extractor', name: 'Analyzing Eligibility' },\n  { id: 'matcher', name: 'Matching Your Profile' },\n  { id: 'advocate', name: 'Creating Summary' },\n];\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction createStep(\n  id: PipelineStep['id'],\n  status: PipelineStep['status'],\n  progress?: number,\n  error?: string\n): PipelineStep {\n  const stepConfig = PIPELINE_STEPS.find((s) => s.id === id)!;\n  return {\n    ...stepConfig,\n    status,\n    progress,\n    error,\n  };\n}\n\nasync function sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nasync function withRetry<T>(\n  fn: () => Promise<T>,\n  maxRetries: number = 2,\n  baseDelayMs: number = 1000\n): Promise<T> {\n  let lastError: Error | undefined;\n\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error instanceof Error ? error : new Error(String(error));\n\n      if (attempt < maxRetries) {\n        await sleep(baseDelayMs * Math.pow(2, attempt));\n      }\n    }\n  }\n\n  throw lastError;\n}\n\n// ============================================================================\n// Main Pipeline Function\n// ============================================================================\n\n/**\n * Run the complete clinical trial matching pipeline\n */\nexport async function runPipeline(\n  patientProfile: PatientProfile,\n  onProgress: ProgressCallback,\n  options: PipelineOptions = {}\n): Promise<PipelineResult> {\n  const { maxTrials = 5, concurrency = 3, abortSignal } = options;\n  const startTime = Date.now();\n  const completedSteps: PipelineStep[] = [];\n  const logs: string[] = [];\n\n  const addLog = (message: string) => {\n    logs.push(`[${new Date().toISOString()}] ${message}`);\n  };\n\n  const checkAbort = () => {\n    if (abortSignal?.aborted) {\n      throw new Error('Pipeline cancelled by user');\n    }\n  };\n\n  try {\n    // ========================================================================\n    // Step 1: Scout - Discover Trials\n    // ========================================================================\n    addLog('Starting trial discovery...');\n    onProgress(createStep('scout', 'running'), logs);\n\n    checkAbort();\n\n    const scoutResult = await withRetry(() =>\n      runScoutAgent({\n        diagnosis: patientProfile.diagnosis,\n        zipcode: patientProfile.zipcode,\n        travelRadiusMiles: patientProfile.travelRadiusMiles,\n      })\n    );\n\n    if (scoutResult.trials.length === 0) {\n      addLog('No matching trials found');\n      completedSteps.push(createStep('scout', 'complete'));\n\n      // Return early with empty results\n      return {\n        trials: [],\n        matchResults: [],\n        voiceScript: undefined,\n        completedSteps: [\n          createStep('scout', 'complete'),\n          createStep('extractor', 'complete'),\n          createStep('matcher', 'complete'),\n          createStep('advocate', 'complete'),\n        ],\n        duration: Date.now() - startTime,\n      };\n    }\n\n    const trials = scoutResult.trials.slice(0, maxTrials);\n    addLog(`Found ${scoutResult.totalFound} trials, processing top ${trials.length}`);\n    completedSteps.push(createStep('scout', 'complete'));\n    onProgress(createStep('scout', 'complete'), logs);\n\n    // ========================================================================\n    // Step 2: Extractor - Extract Eligibility Criteria\n    // ========================================================================\n    addLog('Extracting eligibility criteria...');\n    onProgress(createStep('extractor', 'running', 0), logs);\n\n    checkAbort();\n\n    const eligibilityMap = new Map<string, EligibilityCriteria>();\n    const extractionErrors: string[] = [];\n\n    // Process in batches for concurrency control\n    for (let i = 0; i < trials.length; i += concurrency) {\n      checkAbort();\n\n      const batch = trials.slice(i, i + concurrency);\n      const batchResults = await Promise.allSettled(\n        batch.map((trial) =>\n          withRetry(() => runExtractorAgent({ nctId: trial.nctId }))\n        )\n      );\n\n      batchResults.forEach((result, idx) => {\n        const trial = batch[idx];\n        if (result.status === 'fulfilled') {\n          eligibilityMap.set(trial.nctId, result.value);\n          addLog(`Extracted criteria for ${trial.nctId}`);\n        } else {\n          extractionErrors.push(trial.nctId);\n          addLog(`Failed to extract criteria for ${trial.nctId}: ${result.reason}`);\n        }\n      });\n\n      const progress = Math.round(((i + batch.length) / trials.length) * 100);\n      onProgress(createStep('extractor', 'running', progress), logs);\n    }\n\n    completedSteps.push(createStep('extractor', 'complete'));\n    onProgress(createStep('extractor', 'complete'), logs);\n\n    // Filter trials with successful extraction\n    const trialsWithCriteria = trials.filter((t) => eligibilityMap.has(t.nctId));\n\n    if (trialsWithCriteria.length === 0) {\n      addLog('Could not extract criteria for any trials');\n      return {\n        trials,\n        matchResults: [],\n        voiceScript: undefined,\n        completedSteps: [...completedSteps, createStep('matcher', 'error', undefined, 'No criteria extracted')],\n        duration: Date.now() - startTime,\n      };\n    }\n\n    // ========================================================================\n    // Step 3: Matcher - Match Patient Profile\n    // ========================================================================\n    addLog('Matching your profile against trials...');\n    onProgress(createStep('matcher', 'running', 0), logs);\n\n    checkAbort();\n\n    const matchResults: MatchResult[] = [];\n    const matchErrors: string[] = [];\n\n    for (let i = 0; i < trialsWithCriteria.length; i += concurrency) {\n      checkAbort();\n\n      const batch = trialsWithCriteria.slice(i, i + concurrency);\n      const batchResults = await Promise.allSettled(\n        batch.map((trial) => {\n          const criteria = eligibilityMap.get(trial.nctId)!;\n          return withRetry(() =>\n            runMatcherAgent({\n              patientProfile,\n              eligibilityCriteria: criteria,\n              nctId: trial.nctId,\n            })\n          );\n        })\n      );\n\n      batchResults.forEach((result, idx) => {\n        const trial = batch[idx];\n        if (result.status === 'fulfilled') {\n          matchResults.push(result.value);\n          addLog(`Matched ${trial.nctId}: ${result.value.category} (${result.value.score})`);\n        } else {\n          matchErrors.push(trial.nctId);\n          addLog(`Failed to match ${trial.nctId}: ${result.reason}`);\n        }\n      });\n\n      const progress = Math.round(((i + batch.length) / trialsWithCriteria.length) * 100);\n      onProgress(createStep('matcher', 'running', progress), logs);\n    }\n\n    // Sort by score descending\n    matchResults.sort((a, b) => b.score - a.score);\n\n    completedSteps.push(createStep('matcher', 'complete'));\n    onProgress(createStep('matcher', 'complete'), logs);\n\n    // ========================================================================\n    // Step 4: Advocate - Generate Voice Summary\n    // ========================================================================\n    addLog('Creating your personalized summary...');\n    onProgress(createStep('advocate', 'running'), logs);\n\n    checkAbort();\n\n    let voiceScript: VoiceScript | undefined;\n\n    try {\n      voiceScript = await withRetry(() =>\n        runAdvocateAgent({\n          matchResults,\n          patientProfile,\n          language: patientProfile.languagePreference,\n        })\n      );\n      addLog('Voice summary created successfully');\n    } catch (error) {\n      addLog(`Voice summary failed: ${error}`);\n      // Continue without voice - not a critical failure\n    }\n\n    completedSteps.push(createStep('advocate', 'complete'));\n    onProgress(createStep('advocate', 'complete'), logs);\n\n    // ========================================================================\n    // Return Results\n    // ========================================================================\n    return {\n      trials: trialsWithCriteria,\n      matchResults,\n      voiceScript,\n      completedSteps,\n      duration: Date.now() - startTime,\n    };\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    addLog(`Pipeline error: ${errorMessage}`);\n\n    // Find the failed step\n    const failedStepId = completedSteps.length < PIPELINE_STEPS.length\n      ? PIPELINE_STEPS[completedSteps.length].id\n      : 'advocate';\n\n    completedSteps.push(createStep(failedStepId as PipelineStep['id'], 'error', undefined, errorMessage));\n\n    throw error;\n  }\n}\n\n// ============================================================================\n// Pipeline Status Utilities\n// ============================================================================\n\n/**\n * Get initial pipeline steps (all pending)\n */\nexport function getInitialSteps(): PipelineStep[] {\n  return PIPELINE_STEPS.map((step) => ({\n    ...step,\n    status: 'pending' as const,\n  }));\n}\n\n/**\n * Calculate overall pipeline progress\n */\nexport function calculateOverallProgress(steps: PipelineStep[]): number {\n  const weights = { scout: 15, extractor: 35, matcher: 35, advocate: 15 };\n  let totalProgress = 0;\n\n  for (const step of steps) {\n    const weight = weights[step.id];\n    if (step.status === 'complete') {\n      totalProgress += weight;\n    } else if (step.status === 'running' && step.progress !== undefined) {\n      totalProgress += (weight * step.progress) / 100;\n    }\n  }\n\n  return Math.round(totalProgress);\n}\n\n/**\n * Get human-readable status message\n */\nexport function getStatusMessage(steps: PipelineStep[]): string {\n  const currentStep = steps.find((s) => s.status === 'running');\n  if (currentStep) {\n    return currentStep.name;\n  }\n\n  const errorStep = steps.find((s) => s.status === 'error');\n  if (errorStep) {\n    return `Error: ${errorStep.error || 'Unknown error'}`;\n  }\n\n  const allComplete = steps.every((s) => s.status === 'complete');\n  if (allComplete) {\n    return 'Complete';\n  }\n\n  return 'Ready to start';\n}\n","import { useEffect, useState, useRef, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { AlertCircle, RefreshCw } from 'lucide-react';\nimport { ProgressIndicator } from '../components/ProgressIndicator';\nimport { DisclaimerBanner } from '../components/DisclaimerBanner';\nimport { useSession } from '../context/SessionContext';\nimport { runPipeline, getInitialSteps } from '../../lib/orchestrator';\nimport type { PipelineStep } from '../../lib/schemas';\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport function Processing() {\n  const navigate = useNavigate();\n  const { patientProfile, setPipelineResults } = useSession();\n  const [steps, setSteps] = useState<PipelineStep[]>(getInitialSteps);\n  const [currentStep, setCurrentStep] = useState(0);\n  const [logs, setLogs] = useState<string[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [isRetrying, setIsRetrying] = useState(false);\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const hasStartedRef = useRef(false);\n\n  // Redirect if no patient profile\n  useEffect(() => {\n    if (!patientProfile) {\n      navigate('/intake');\n    }\n  }, [patientProfile, navigate]);\n\n  // Run pipeline\n  const runPipelineWithProgress = useCallback(async () => {\n    if (!patientProfile || hasStartedRef.current) return;\n\n    hasStartedRef.current = true;\n    setError(null);\n    setSteps(getInitialSteps());\n    setCurrentStep(0);\n    setLogs([]);\n\n    abortControllerRef.current = new AbortController();\n\n    try {\n      const results = await runPipeline(\n        patientProfile,\n        (step, stepLogs) => {\n          setSteps((prev) => {\n            const newSteps = [...prev];\n            const stepIndex = newSteps.findIndex((s) => s.id === step.id);\n            if (stepIndex >= 0) {\n              newSteps[stepIndex] = step;\n              // Update current step to the latest running or completed step\n              if (step.status === 'running') {\n                setCurrentStep(stepIndex);\n              }\n            }\n            return newSteps;\n          });\n\n          if (stepLogs) {\n            setLogs(stepLogs);\n          }\n        },\n        {\n          abortSignal: abortControllerRef.current.signal,\n        }\n      );\n\n      // Store results and navigate\n      setPipelineResults(results);\n      navigate('/results');\n    } catch (err) {\n      if (err instanceof Error && err.message === 'Pipeline cancelled by user') {\n        navigate('/intake');\n        return;\n      }\n\n      setError(err instanceof Error ? err.message : 'An unexpected error occurred');\n    }\n  }, [patientProfile, navigate, setPipelineResults]);\n\n  // Start pipeline on mount\n  useEffect(() => {\n    runPipelineWithProgress();\n\n    // Note: Don't abort on cleanup - React StrictMode double-mounts\n    // and would abort the pipeline prematurely\n  }, [runPipelineWithProgress]);\n\n  // Warn before leaving\n  useEffect(() => {\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (!error) {\n        e.preventDefault();\n        e.returnValue = '';\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [error]);\n\n  // Handle retry\n  const handleRetry = () => {\n    setIsRetrying(true);\n    hasStartedRef.current = false;\n    setError(null);\n    runPipelineWithProgress().finally(() => setIsRetrying(false));\n  };\n\n  // Handle cancel\n  const handleCancel = () => {\n    abortControllerRef.current?.abort();\n    navigate('/intake');\n  };\n\n  if (!patientProfile) {\n    return null; // Will redirect in useEffect\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24\">\n      {/* Main Content */}\n      <main className=\"max-w-xl mx-auto px-4 py-16\">\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">\n            Finding Your Matches\n          </h1>\n          <p className=\"mt-2 text-gray-600\">\n            This may take a moment while we analyze available trials...\n          </p>\n        </div>\n\n        {/* Progress Indicator */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8\">\n          <ProgressIndicator\n            currentStep={currentStep}\n            steps={steps}\n            logs={logs}\n          />\n        </div>\n\n        {/* Error State */}\n        {error && (\n          <div className=\"mt-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n            <div className=\"flex items-start gap-3\">\n              <AlertCircle className=\"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5\" />\n              <div className=\"flex-1\">\n                <h3 className=\"font-medium text-red-800\">Something went wrong</h3>\n                <p className=\"mt-1 text-sm text-red-700\">{error}</p>\n                <div className=\"mt-4 flex gap-3\">\n                  <button\n                    onClick={handleRetry}\n                    disabled={isRetrying}\n                    className=\"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50\"\n                  >\n                    {isRetrying ? (\n                      <>\n                        <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                        Retrying...\n                      </>\n                    ) : (\n                      <>\n                        <RefreshCw className=\"w-4 h-4 mr-2\" />\n                        Try Again\n                      </>\n                    )}\n                  </button>\n                  <button\n                    onClick={() => navigate('/intake')}\n                    className=\"px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-lg border border-gray-300 hover:bg-gray-50\"\n                  >\n                    Modify Profile\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Cancel button */}\n        {!error && (\n          <div className=\"mt-8 text-center\">\n            <button\n              onClick={handleCancel}\n              className=\"text-sm text-gray-500 hover:text-gray-700 underline\"\n            >\n              Cancel and go back\n            </button>\n          </div>\n        )}\n\n        {/* Fun Facts (while waiting) */}\n        {!error && (\n          <div className=\"mt-12 p-6 bg-blue-50 rounded-lg\">\n            <h3 className=\"font-medium text-blue-900 mb-2\">Did you know?</h3>\n            <p className=\"text-sm text-blue-800\">\n              Clinical trials are essential for developing new treatments. They help\n              researchers understand how well new medicines work and what side effects\n              they might cause. Every approved treatment was once tested in a clinical trial.\n            </p>\n          </div>\n        )}\n      </main>\n\n      <DisclaimerBanner />\n    </div>\n  );\n}\n"],"names":["AlertCircle","createLucideIcon","Circle","Loader2","STEP_DESCRIPTIONS","StepIcon","status","jsx","Check","X","ElapsedTimer","startTime","elapsed","setElapsed","useState","useEffect","interval","minutes","seconds","jsxs","ProgressIndicator","currentStep","steps","logs","showLogs","setShowLogs","stepStartTimes","_a","step","index","isActive","isPast","isError","Fragment","ChevronUp","ChevronDown","log","idx","ZIPCODE_DATA","getCoordinates","zipcode","isValidZipcode","EARTH_RADIUS_MILES","toRadians","degrees","calculateDistance","coord1","coord2","lat1","lat2","deltaLat","deltaLng","c","filterByRadius","locations","originZip","radiusMiles","originCoords","locationsWithDistance","location","locationCoords","distance","a","b","addDistanceToLocations","MAX_TRIALS_TO_RETURN","getMockTrials","condition","mockStudies","queryClinicalTrials","phases","resolve","mapPhase","phase","transformStudyToTrial","study","protocolSection","identificationModule","statusModule","nctId","loc","interventions","_c","_b","i","_d","_f","_e","_g","runScoutAgent","input","diagnosis","travelRadiusMiles","response","trials","trial","filteredLocations","distA","distB","error","getMockEligibility","runExtractorAgent","CRITERIA_WEIGHTS","checkECOG","patientECOG","criteria","ecogCriteria","ecogMatch","minECOG","maxECOG","checkBiomarkers","patientBiomarkers","matches","conflicts","uncertain","biomarkerCriteria","excludedBiomarkers","normalize","s","normalizedPatient","criterion","criterionNorm","pb","checkTreatmentHistory","previousTreatments","treatmentInclusion","treatmentExclusion","normalizedTreatments","t","required","excluded","calculateScore","matchingFactors","blockingFactors","uncertainFactors","totalWeight","sum","f","maxPossibleWeight","uncertaintyPenalty","score","category","generateSummary","runMatcherAgent","patientProfile","eligibilityCriteria","matchWithRules","profile","ecogResult","biomarkerResult","match","conflict","u","treatmentResult","diagnosisCriteria","diagnosisLower","summary","VOICE_MAP","DEFAULT_VOICE_ID","MODEL_ID","MAX_TEXT_LENGTH","createElevenLabsClient","apiKey","getElevenLabsApiKey","estimateDuration","text","minutesDuration","splitTextIntoChunks","maxLength","chunks","sentences","currentChunk","sentence","synthesizeSpeech","client","options","voiceId","language","stability","similarityBoost","selectedVoiceId","synthesizeChunk","audioBlobs","totalDuration","chunk","result","blob","combinedBlob","url","errorData","audioBlob","getVoiceForLanguage","REQUIRED_DISCLAIMER","LANGUAGE_GREETINGS","getStrongMatchTemplate","topMatches","greeting","getPossibleMatchTemplate","getNoStrongMatchTemplate","generateScriptFromTemplate","matchResults","strongMatches","m","possibleMatches","runAdvocateAgent","scriptText","elevenLabsClient","audioResult","audioError","wordCount","PIPELINE_STEPS","createStep","id","progress","sleep","ms","withRetry","fn","maxRetries","baseDelayMs","lastError","attempt","runPipeline","onProgress","maxTrials","concurrency","abortSignal","completedSteps","addLog","message","checkAbort","scoutResult","eligibilityMap","extractionErrors","batch","trialsWithCriteria","matchErrors","voiceScript","errorMessage","failedStepId","getInitialSteps","Processing","navigate","useNavigate","setPipelineResults","useSession","setSteps","setCurrentStep","setLogs","setError","isRetrying","setIsRetrying","abortControllerRef","useRef","hasStartedRef","runPipelineWithProgress","useCallback","results","stepLogs","prev","newSteps","stepIndex","err","handleBeforeUnload","e","handleRetry","handleCancel","RefreshCw","DisclaimerBanner"],"mappings":"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","x_google_ignoreList":[0,1,2]}